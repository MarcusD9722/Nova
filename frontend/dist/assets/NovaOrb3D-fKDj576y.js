import{r as Se,j as he,R as Tt}from"./index-D0eijIkW.js";import{M as _i,c as Ei,R as Mi,U as Di,S as Ai,d as hr,e as Zn,b as pt,a as Xr,f as Ci,V as ke,I as Ri,g as Fi,h as Jn,i as Bi,T as Ht,L as wt,j as ki,k as ur,D as It,P as Yr,l as Wt,s as Pi,m as Kr,n as Zr,u as jt,o as Oi,p as vt,q as Le,r as Ii,t as Gi,v as Li,w as zi,W as $e,x as Ni,N as fr,F as Hi,y as Ut,E as Jr,z as Qn,G as qn,H as wn,J as Wi,K as ir,O as rt,Q as ji,X as gt,Y as Ue,Z as $n,_ as ei,$ as Vi,B as Xi,a0 as Un,a1 as Yi,a2 as Ki,a3 as Zi,C as Ji,a4 as Qi,a5 as qi,a6 as $i,a7 as ea,A as ti}from"./react-three-fiber.esm-CNNOyQEe.js";function cr(){return cr=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var u=arguments[t];for(var f in u)({}).hasOwnProperty.call(u,f)&&(n[f]=u[f])}return n},cr.apply(null,arguments)}function ta(){var n=Object.create(null);function t(r,e){var i=r.id,s=r.name,a=r.dependencies;a===void 0&&(a=[]);var o=r.init;o===void 0&&(o=function(){});var l=r.getTransferables;if(l===void 0&&(l=null),!n[i])try{a=a.map(function(h){return h&&h.isWorkerModule&&(t(h,function(d){if(d instanceof Error)throw d}),h=n[h.id].value),h}),o=f("<"+s+">.init",o),l&&(l=f("<"+s+">.getTransferables",l));var c=null;typeof o=="function"?c=o.apply(void 0,a):console.error("worker module init function failed to rehydrate"),n[i]={id:i,value:c,getTransferables:l},e(c)}catch(h){h&&h.noLog||console.error(h),e(h)}}function u(r,e){var i,s=r.id,a=r.args;(!n[s]||typeof n[s].value!="function")&&e(new Error("Worker module "+s+": not found or its 'init' did not return a function"));try{var o=(i=n[s]).value.apply(i,a);o&&typeof o.then=="function"?o.then(l,function(c){return e(c instanceof Error?c:new Error(""+c))}):l(o)}catch(c){e(c)}function l(c){try{var h=n[s].getTransferables&&n[s].getTransferables(c);(!h||!Array.isArray(h)||!h.length)&&(h=void 0),e(c,h)}catch(d){console.error(d),e(d)}}}function f(r,e){var i=void 0;self.troikaDefine=function(a){return i=a};var s=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(s)}catch(a){console.error(a)}return URL.revokeObjectURL(s),delete self.troikaDefine,i}self.addEventListener("message",function(r){var e=r.data,i=e.messageId,s=e.action,a=e.data;try{s==="registerModule"&&t(a,function(o){o instanceof Error?postMessage({messageId:i,success:!1,error:o.message}):postMessage({messageId:i,success:!0,result:{isCallable:typeof o=="function"}})}),s==="callModule"&&u(a,function(o,l){o instanceof Error?postMessage({messageId:i,success:!1,error:o.message}):postMessage({messageId:i,success:!0,result:o},l||void 0)})}catch(o){postMessage({messageId:i,success:!1,error:o.stack})}})}function ra(n){var t=function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,u);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var u=n.dependencies,f=n.init;u=Array.isArray(u)?u.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var r=Promise.all(u).then(function(e){return f.apply(null,e)});return t._getInitResult=function(){return r},r},t}var ri=function(){var n=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),n=!0}catch(u){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+u.message+"]")}return ri=function(){return n},n},na=0,ia=0,kr=!1,Lt=Object.create(null),zt=Object.create(null),zr=Object.create(null);function _t(n){if((!n||typeof n.init!="function")&&!kr)throw new Error("requires `options.init` function");var t=n.dependencies,u=n.init,f=n.getTransferables,r=n.workerId,e=ra(n);r==null&&(r="#default");var i="workerModule"+ ++na,s=n.name||i,a=null;t=t&&t.map(function(l){return typeof l=="function"&&!l.workerModuleData&&(kr=!0,l=_t({workerId:r,name:"<"+s+"> function dependency: "+l.name,init:`function(){return (
`+or(l)+`
)}`}),kr=!1),l&&l.workerModuleData&&(l=l.workerModuleData),l});function o(){for(var l=[],c=arguments.length;c--;)l[c]=arguments[c];if(!ri())return e.apply(void 0,l);if(!a){a=_n(r,"registerModule",o.workerModuleData);var h=function(){a=null,zt[r].delete(h)};(zt[r]||(zt[r]=new Set)).add(h)}return a.then(function(d){var v=d.isCallable;if(v)return _n(r,"callModule",{id:i,args:l});throw new Error("Worker module function was called but `init` did not return a callable function")})}return o.workerModuleData={isWorkerModule:!0,id:i,name:s,dependencies:t,init:or(u),getTransferables:f&&or(f)},o.onMainThread=e,o}function aa(n){zt[n]&&zt[n].forEach(function(t){t()}),Lt[n]&&(Lt[n].terminate(),delete Lt[n])}function or(n){var t=n.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function sa(n){var t=Lt[n];if(!t){var u=or(ta);t=Lt[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+` **/

;(`+u+")()"],{type:"application/javascript"}))),t.onmessage=function(f){var r=f.data,e=r.messageId,i=zr[e];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete zr[e],i(r)}}return t}function _n(n,t,u){return new Promise(function(f,r){var e=++ia;zr[e]=function(i){i.success?f(i.result):r(new Error("Error in worker "+t+" call: "+i.error))},sa(n).postMessage({messageId:e,action:t,data:u})})}function ni(){var n=function(t){function u(G,k,p,T,D,A,E,z){var B=1-E;z.x=B*B*G+2*B*E*p+E*E*D,z.y=B*B*k+2*B*E*T+E*E*A}function f(G,k,p,T,D,A,E,z,B,L){var Y=1-B;L.x=Y*Y*Y*G+3*Y*Y*B*p+3*Y*B*B*D+B*B*B*E,L.y=Y*Y*Y*k+3*Y*Y*B*T+3*Y*B*B*A+B*B*B*z}function r(G,k){for(var p=/([MLQCZ])([^MLQCZ]*)/g,T,D,A,E,z;T=p.exec(G);){var B=T[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(L){return parseFloat(L)});switch(T[1]){case"M":E=D=B[0],z=A=B[1];break;case"L":(B[0]!==E||B[1]!==z)&&k("L",E,z,E=B[0],z=B[1]);break;case"Q":{k("Q",E,z,E=B[2],z=B[3],B[0],B[1]);break}case"C":{k("C",E,z,E=B[4],z=B[5],B[0],B[1],B[2],B[3]);break}case"Z":(E!==D||z!==A)&&k("L",E,z,D,A);break}}}function e(G,k,p){p===void 0&&(p=16);var T={x:0,y:0};r(G,function(D,A,E,z,B,L,Y,$,V){switch(D){case"L":k(A,E,z,B);break;case"Q":{for(var N=A,ge=E,fe=1;fe<p;fe++)u(A,E,L,Y,z,B,fe/(p-1),T),k(N,ge,T.x,T.y),N=T.x,ge=T.y;break}case"C":{for(var J=A,ee=E,oe=1;oe<p;oe++)f(A,E,L,Y,$,V,z,B,oe/(p-1),T),k(J,ee,T.x,T.y),J=T.x,ee=T.y;break}}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",s="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",a=new WeakMap,o={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(G,k){var p=G.getContext?G.getContext("webgl",o):G,T=a.get(p);if(!T){let Y=function(J){var ee=A[J];if(!ee&&(ee=A[J]=p.getExtension(J),!ee))throw new Error(J+" not supported");return ee},$=function(J,ee){var oe=p.createShader(ee);return p.shaderSource(oe,J),p.compileShader(oe),oe},V=function(J,ee,oe,j){if(!E[J]){var te={},q={},I=p.createProgram();p.attachShader(I,$(ee,p.VERTEX_SHADER)),p.attachShader(I,$(oe,p.FRAGMENT_SHADER)),p.linkProgram(I),E[J]={program:I,transaction:function(Z){p.useProgram(I),Z({setUniform:function(K,we){for(var ne=[],ae=arguments.length-2;ae-- >0;)ne[ae]=arguments[ae+2];var ue=q[we]||(q[we]=p.getUniformLocation(I,we));p["uniform"+K].apply(p,[ue].concat(ne))},setAttribute:function(K,we,ne,ae,ue){var ve=te[K];ve||(ve=te[K]={buf:p.createBuffer(),loc:p.getAttribLocation(I,K),data:null}),p.bindBuffer(p.ARRAY_BUFFER,ve.buf),p.vertexAttribPointer(ve.loc,we,p.FLOAT,!1,0,0),p.enableVertexAttribArray(ve.loc),D?p.vertexAttribDivisor(ve.loc,ae):Y("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ve.loc,ae),ue!==ve.data&&(p.bufferData(p.ARRAY_BUFFER,ue,ne),ve.data=ue)}})}}}E[J].transaction(j)},N=function(J,ee){B++;try{p.activeTexture(p.TEXTURE0+B);var oe=z[J];oe||(oe=z[J]=p.createTexture(),p.bindTexture(p.TEXTURE_2D,oe),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.bindTexture(p.TEXTURE_2D,oe),ee(oe,B)}finally{B--}},ge=function(J,ee,oe){var j=p.createFramebuffer();L.push(j),p.bindFramebuffer(p.FRAMEBUFFER,j),p.activeTexture(p.TEXTURE0+ee),p.bindTexture(p.TEXTURE_2D,J),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,J,0);try{oe(j)}finally{p.deleteFramebuffer(j),p.bindFramebuffer(p.FRAMEBUFFER,L[--L.length-1]||null)}},fe=function(){A={},E={},z={},B=-1,L.length=0};var D=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext,A={},E={},z={},B=-1,L=[];p.canvas.addEventListener("webglcontextlost",function(J){fe(),J.preventDefault()},!1),a.set(p,T={gl:p,isWebGL2:D,getExtension:Y,withProgram:V,withTexture:N,withTextureFramebuffer:ge,handleContextLoss:fe})}k(T)}function c(G,k,p,T,D,A,E,z){E===void 0&&(E=15),z===void 0&&(z=null),l(G,function(B){var L=B.gl,Y=B.withProgram,$=B.withTexture;$("copy",function(V,N){L.texImage2D(L.TEXTURE_2D,0,L.RGBA,D,A,0,L.RGBA,L.UNSIGNED_BYTE,k),Y("copy",i,s,function(ge){var fe=ge.setUniform,J=ge.setAttribute;J("aUV",2,L.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),fe("1i","image",N),L.bindFramebuffer(L.FRAMEBUFFER,z||null),L.disable(L.BLEND),L.colorMask(E&8,E&4,E&2,E&1),L.viewport(p,T,D,A),L.scissor(p,T,D,A),L.drawArrays(L.TRIANGLES,0,3)})})})}function h(G,k,p){var T=G.width,D=G.height;l(G,function(A){var E=A.gl,z=new Uint8Array(T*D*4);E.readPixels(0,0,T,D,E.RGBA,E.UNSIGNED_BYTE,z),G.width=k,G.height=p,c(E,z,0,0,T,D)})}var d=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:c,resizeWebGLCanvasWithoutClearing:h});function v(G,k,p,T,D,A){A===void 0&&(A=1);var E=new Uint8Array(G*k),z=T[2]-T[0],B=T[3]-T[1],L=[];e(p,function(J,ee,oe,j){L.push({x1:J,y1:ee,x2:oe,y2:j,minX:Math.min(J,oe),minY:Math.min(ee,j),maxX:Math.max(J,oe),maxY:Math.max(ee,j)})}),L.sort(function(J,ee){return J.maxX-ee.maxX});for(var Y=0;Y<G;Y++)for(var $=0;$<k;$++){var V=ge(T[0]+z*(Y+.5)/G,T[1]+B*($+.5)/k),N=Math.pow(1-Math.abs(V)/D,A)/2;V<0&&(N=1-N),N=Math.max(0,Math.min(255,Math.round(N*255))),E[$*G+Y]=N}return E;function ge(J,ee){for(var oe=1/0,j=1/0,te=L.length;te--;){var q=L[te];if(q.maxX+j<=J)break;if(J+j>q.minX&&ee-j<q.maxY&&ee+j>q.minY){var I=F(J,ee,q.x1,q.y1,q.x2,q.y2);I<oe&&(oe=I,j=Math.sqrt(oe))}}return fe(J,ee)&&(j=-j),j}function fe(J,ee){for(var oe=0,j=L.length;j--;){var te=L[j];if(te.maxX<=J)break;var q=te.y1>ee!=te.y2>ee&&J<(te.x2-te.x1)*(ee-te.y1)/(te.y2-te.y1)+te.x1;q&&(oe+=te.y1<te.y2?1:-1)}return oe!==0}}function g(G,k,p,T,D,A,E,z,B,L){A===void 0&&(A=1),z===void 0&&(z=0),B===void 0&&(B=0),L===void 0&&(L=0),m(G,k,p,T,D,A,E,null,z,B,L)}function m(G,k,p,T,D,A,E,z,B,L,Y){A===void 0&&(A=1),B===void 0&&(B=0),L===void 0&&(L=0),Y===void 0&&(Y=0);for(var $=v(G,k,p,T,D,A),V=new Uint8Array($.length*4),N=0;N<$.length;N++)V[N*4+Y]=$[N];c(E,V,B,L,G,k,1<<3-Y,z)}function F(G,k,p,T,D,A){var E=D-p,z=A-T,B=E*E+z*z,L=B?Math.max(0,Math.min(1,((G-p)*E+(k-T)*z)/B)):0,Y=G-(p+L*E),$=k-(T+L*z);return Y*Y+$*$}var x=Object.freeze({__proto__:null,generate:v,generateIntoCanvas:g,generateIntoFramebuffer:m}),S="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",U="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",P=new Float32Array([0,0,2,0,0,2]),_=null,w=!1,O={},C=new WeakMap;function X(G){if(!w&&!W(G))throw new Error("WebGL generation not supported")}function y(G,k,p,T,D,A,E){if(A===void 0&&(A=1),E===void 0&&(E=null),!E&&(E=_,!E)){var z=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!z)throw new Error("OffscreenCanvas or DOM canvas not supported");E=_=z.getContext("webgl",{depth:!1})}X(E);var B=new Uint8Array(G*k*4);l(E,function(V){var N=V.gl,ge=V.withTexture,fe=V.withTextureFramebuffer;ge("readable",function(J,ee){N.texImage2D(N.TEXTURE_2D,0,N.RGBA,G,k,0,N.RGBA,N.UNSIGNED_BYTE,null),fe(J,ee,function(oe){M(G,k,p,T,D,A,N,oe,0,0,0),N.readPixels(0,0,G,k,N.RGBA,N.UNSIGNED_BYTE,B)})})});for(var L=new Uint8Array(G*k),Y=0,$=0;Y<B.length;Y+=4)L[$++]=B[Y];return L}function R(G,k,p,T,D,A,E,z,B,L){A===void 0&&(A=1),z===void 0&&(z=0),B===void 0&&(B=0),L===void 0&&(L=0),M(G,k,p,T,D,A,E,null,z,B,L)}function M(G,k,p,T,D,A,E,z,B,L,Y){A===void 0&&(A=1),B===void 0&&(B=0),L===void 0&&(L=0),Y===void 0&&(Y=0),X(E);var $=[];e(p,function(V,N,ge,fe){$.push(V,N,ge,fe)}),$=new Float32Array($),l(E,function(V){var N=V.gl,ge=V.isWebGL2,fe=V.getExtension,J=V.withProgram,ee=V.withTexture,oe=V.withTextureFramebuffer,j=V.handleContextLoss;if(ee("rawDistances",function(te,q){(G!==te._lastWidth||k!==te._lastHeight)&&N.texImage2D(N.TEXTURE_2D,0,N.RGBA,te._lastWidth=G,te._lastHeight=k,0,N.RGBA,N.UNSIGNED_BYTE,null),J("main",S,b,function(I){var de=I.setAttribute,Z=I.setUniform,ie=!ge&&fe("ANGLE_instanced_arrays"),K=!ge&&fe("EXT_blend_minmax");de("aUV",2,N.STATIC_DRAW,0,P),de("aLineSegment",4,N.DYNAMIC_DRAW,1,$),Z.apply(void 0,["4f","uGlyphBounds"].concat(T)),Z("1f","uMaxDistance",D),Z("1f","uExponent",A),oe(te,q,function(we){N.enable(N.BLEND),N.colorMask(!0,!0,!0,!0),N.viewport(0,0,G,k),N.scissor(0,0,G,k),N.blendFunc(N.ONE,N.ONE),N.blendEquationSeparate(N.FUNC_ADD,ge?N.MAX:K.MAX_EXT),N.clear(N.COLOR_BUFFER_BIT),ge?N.drawArraysInstanced(N.TRIANGLES,0,3,$.length/4):ie.drawArraysInstancedANGLE(N.TRIANGLES,0,3,$.length/4)})}),J("post",i,U,function(I){I.setAttribute("aUV",2,N.STATIC_DRAW,0,P),I.setUniform("1i","tex",q),N.bindFramebuffer(N.FRAMEBUFFER,z),N.disable(N.BLEND),N.colorMask(Y===0,Y===1,Y===2,Y===3),N.viewport(B,L,G,k),N.scissor(B,L,G,k),N.drawArrays(N.TRIANGLES,0,3)})}),N.isContextLost())throw j(),new Error("webgl context lost")})}function W(G){var k=!G||G===_?O:G.canvas||G,p=C.get(k);if(p===void 0){w=!0;var T=null;try{var D=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],A=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);p=A&&D.length===A.length&&A.every(function(E,z){return E===D[z]}),p||(T="bad trial run results",console.info(D,A))}catch(E){p=!1,T=E.message}T&&console.warn("WebGL SDF generation not supported:",T),w=!1,C.set(k,p)}return p}var H=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:R,generateIntoFramebuffer:M,isSupported:W});function Q(G,k,p,T,D,A){D===void 0&&(D=Math.max(T[2]-T[0],T[3]-T[1])/2),A===void 0&&(A=1);try{return y.apply(H,arguments)}catch(E){return console.info("WebGL SDF generation failed, falling back to JS",E),v.apply(x,arguments)}}function re(G,k,p,T,D,A,E,z,B,L){D===void 0&&(D=Math.max(T[2]-T[0],T[3]-T[1])/2),A===void 0&&(A=1),z===void 0&&(z=0),B===void 0&&(B=0),L===void 0&&(L=0);try{return R.apply(H,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),g.apply(x,arguments)}}return t.forEachPathCommand=r,t.generate=Q,t.generateIntoCanvas=re,t.javascript=x,t.pathToLineSegments=e,t.webgl=H,t.webglUtils=d,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return n}function oa(){var n=function(t){var u={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},f={},r={};f.L=1,r[1]="L",Object.keys(u).forEach(function(j,te){f[j]=1<<te+1,r[f[j]]=j}),Object.freeze(f);var e=f.LRI|f.RLI|f.FSI,i=f.L|f.R|f.AL,s=f.B|f.S|f.WS|f.ON|f.FSI|f.LRI|f.RLI|f.PDI,a=f.BN|f.RLE|f.LRE|f.RLO|f.LRO|f.PDF,o=f.S|f.WS|f.B|e|f.PDI|a,l=null;function c(){if(!l){l=new Map;var j=function(q){if(u.hasOwnProperty(q)){var I=0;u[q].split(",").forEach(function(de){var Z=de.split("+"),ie=Z[0],K=Z[1];ie=parseInt(ie,36),K=K?parseInt(K,36):0,l.set(I+=ie,f[q]);for(var we=0;we<K;we++)l.set(++I,f[q])})}};for(var te in u)j(te)}}function h(j){return c(),l.get(j.codePointAt(0))||f.L}function d(j){return r[h(j)]}var v={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function g(j,te){var q=36,I=0,de=new Map,Z=te&&new Map,ie;return j.split(",").forEach(function K(we){if(we.indexOf("+")!==-1)for(var ne=+we;ne--;)K(ie);else{ie=we;var ae=we.split(">"),ue=ae[0],ve=ae[1];ue=String.fromCodePoint(I+=parseInt(ue,q)),ve=String.fromCodePoint(I+=parseInt(ve,q)),de.set(ue,ve),te&&Z.set(ve,ue)}}),{map:de,reverseMap:Z}}var m,F,x;function S(){if(!m){var j=g(v.pairs,!0),te=j.map,q=j.reverseMap;m=te,F=q,x=g(v.canonical,!1).map}}function b(j){return S(),m.get(j)||null}function U(j){return S(),F.get(j)||null}function P(j){return S(),x.get(j)||null}var _=f.L,w=f.R,O=f.EN,C=f.ES,X=f.ET,y=f.AN,R=f.CS,M=f.B,W=f.S,H=f.ON,Q=f.BN,re=f.NSM,G=f.AL,k=f.LRO,p=f.RLO,T=f.LRE,D=f.RLE,A=f.PDF,E=f.LRI,z=f.RLI,B=f.FSI,L=f.PDI;function Y(j,te){for(var q=125,I=new Uint32Array(j.length),de=0;de<j.length;de++)I[de]=h(j[de]);var Z=new Map;function ie(je,Qe){var Ve=I[je];I[je]=Qe,Z.set(Ve,Z.get(Ve)-1),Ve&s&&Z.set(s,Z.get(s)-1),Z.set(Qe,(Z.get(Qe)||0)+1),Qe&s&&Z.set(s,(Z.get(s)||0)+1)}for(var K=new Uint8Array(j.length),we=new Map,ne=[],ae=null,ue=0;ue<j.length;ue++)ae||ne.push(ae={start:ue,end:j.length-1,level:te==="rtl"?1:te==="ltr"?0:Sn(ue,!1)}),I[ue]&M&&(ae.end=ue,ae=null);for(var ve=D|T|p|k|e|L|A|M,Me=function(je){return je+(je&1?1:2)},Fe=function(je){return je+(je&1?2:1)},me=0;me<ne.length;me++){ae=ne[me];var ye=[{_level:ae.level,_override:0,_isolate:0}],le=void 0,Be=0,Ae=0,We=0;Z.clear();for(var De=ae.start;De<=ae.end;De++){var ce=I[De];if(le=ye[ye.length-1],Z.set(ce,(Z.get(ce)||0)+1),ce&s&&Z.set(s,(Z.get(s)||0)+1),ce&ve)if(ce&(D|T)){K[De]=le._level;var _e=(ce===D?Fe:Me)(le._level);_e<=q&&!Be&&!Ae?ye.push({_level:_e,_override:0,_isolate:0}):Be||Ae++}else if(ce&(p|k)){K[De]=le._level;var nt=(ce===p?Fe:Me)(le._level);nt<=q&&!Be&&!Ae?ye.push({_level:nt,_override:ce&p?w:_,_isolate:0}):Be||Ae++}else if(ce&e){ce&B&&(ce=Sn(De+1,!0)===1?z:E),K[De]=le._level,le._override&&ie(De,le._override);var Ee=(ce===z?Fe:Me)(le._level);Ee<=q&&Be===0&&Ae===0?(We++,ye.push({_level:Ee,_override:0,_isolate:1,_isolInitIndex:De})):Be++}else if(ce&L){if(Be>0)Be--;else if(We>0){for(Ae=0;!ye[ye.length-1]._isolate;)ye.pop();var xe=ye[ye.length-1]._isolInitIndex;xe!=null&&(we.set(xe,De),we.set(De,xe)),ye.pop(),We--}le=ye[ye.length-1],K[De]=le._level,le._override&&ie(De,le._override)}else ce&A?(Be===0&&(Ae>0?Ae--:!le._isolate&&ye.length>1&&(ye.pop(),le=ye[ye.length-1])),K[De]=le._level):ce&M&&(K[De]=ae.level);else K[De]=le._level,le._override&&ce!==Q&&ie(De,le._override)}for(var Pe=[],Ce=null,pe=ae.start;pe<=ae.end;pe++){var Re=I[pe];if(!(Re&a)){var Ne=K[pe],Ge=Re&e,Oe=Re===L;Ce&&Ne===Ce._level?(Ce._end=pe,Ce._endsWithIsolInit=Ge):Pe.push(Ce={_start:pe,_end:pe,_level:Ne,_startsWithPDI:Oe,_endsWithIsolInit:Ge})}}for(var Ze=[],it=0;it<Pe.length;it++){var et=Pe[it];if(!et._startsWithPDI||et._startsWithPDI&&!we.has(et._start)){for(var at=[Ce=et],ut=void 0;Ce&&Ce._endsWithIsolInit&&(ut=we.get(Ce._end))!=null;)for(var tt=it+1;tt<Pe.length;tt++)if(Pe[tt]._start===ut){at.push(Ce=Pe[tt]);break}for(var He=[],ft=0;ft<at.length;ft++)for(var en=at[ft],vr=en._start;vr<=en._end;vr++)He.push(vr);for(var xi=K[He[0]],tn=ae.level,Vt=He[0]-1;Vt>=0;Vt--)if(!(I[Vt]&a)){tn=K[Vt];break}var pr=He[He.length-1],bi=K[pr],rn=ae.level;if(!(I[pr]&e)){for(var Xt=pr+1;Xt<=ae.end;Xt++)if(!(I[Xt]&a)){rn=K[Xt];break}}Ze.push({_seqIndices:He,_sosType:Math.max(tn,xi)%2?w:_,_eosType:Math.max(rn,bi)%2?w:_})}}for(var gr=0;gr<Ze.length;gr++){var mr=Ze[gr],se=mr._seqIndices,Et=mr._sosType,Si=mr._eosType,mt=K[se[0]]&1?w:_;if(Z.get(re))for(var Yt=0;Yt<se.length;Yt++){var nn=se[Yt];if(I[nn]&re){for(var yr=Et,Kt=Yt-1;Kt>=0;Kt--)if(!(I[se[Kt]]&a)){yr=I[se[Kt]];break}ie(nn,yr&(e|L)?H:yr)}}if(Z.get(O))for(var Zt=0;Zt<se.length;Zt++){var an=se[Zt];if(I[an]&O)for(var Jt=Zt-1;Jt>=-1;Jt--){var sn=Jt===-1?Et:I[se[Jt]];if(sn&i){sn===G&&ie(an,y);break}}}if(Z.get(G))for(var xr=0;xr<se.length;xr++){var on=se[xr];I[on]&G&&ie(on,w)}if(Z.get(C)||Z.get(R))for(var Mt=1;Mt<se.length-1;Mt++){var br=se[Mt];if(I[br]&(C|R)){for(var yt=0,Sr=0,Tr=Mt-1;Tr>=0&&(yt=I[se[Tr]],!!(yt&a));Tr--);for(var wr=Mt+1;wr<se.length&&(Sr=I[se[wr]],!!(Sr&a));wr++);yt===Sr&&(I[br]===C?yt===O:yt&(O|y))&&ie(br,yt)}}if(Z.get(O))for(var qe=0;qe<se.length;qe++){var Ti=se[qe];if(I[Ti]&O){for(var Qt=qe-1;Qt>=0&&I[se[Qt]]&(X|a);Qt--)ie(se[Qt],O);for(qe++;qe<se.length&&I[se[qe]]&(X|a|O);qe++)I[se[qe]]!==O&&ie(se[qe],O)}}if(Z.get(X)||Z.get(C)||Z.get(R))for(var Dt=0;Dt<se.length;Dt++){var ln=se[Dt];if(I[ln]&(X|C|R)){ie(ln,H);for(var qt=Dt-1;qt>=0&&I[se[qt]]&a;qt--)ie(se[qt],H);for(var $t=Dt+1;$t<se.length&&I[se[$t]]&a;$t++)ie(se[$t],H)}}if(Z.get(O))for(var Ur=0,un=Et;Ur<se.length;Ur++){var fn=se[Ur],_r=I[fn];_r&O?un===_&&ie(fn,_):_r&i&&(un=_r)}if(Z.get(s)){var At=w|O|y,cn=At|_,er=[];{for(var xt=[],bt=0;bt<se.length;bt++)if(I[se[bt]]&s){var Ct=j[se[bt]],hn=void 0;if(b(Ct)!==null)if(xt.length<63)xt.push({char:Ct,seqIndex:bt});else break;else if((hn=U(Ct))!==null)for(var Rt=xt.length-1;Rt>=0;Rt--){var Er=xt[Rt].char;if(Er===hn||Er===U(P(Ct))||b(P(Er))===Ct){er.push([xt[Rt].seqIndex,bt]),xt.length=Rt;break}}}er.sort(function(je,Qe){return je[0]-Qe[0]})}for(var Mr=0;Mr<er.length;Mr++){for(var dn=er[Mr],tr=dn[0],Dr=dn[1],vn=!1,Je=0,Ar=tr+1;Ar<Dr;Ar++){var pn=se[Ar];if(I[pn]&cn){vn=!0;var gn=I[pn]&At?w:_;if(gn===mt){Je=gn;break}}}if(vn&&!Je){Je=Et;for(var Cr=tr-1;Cr>=0;Cr--){var mn=se[Cr];if(I[mn]&cn){var yn=I[mn]&At?w:_;yn!==mt?Je=yn:Je=mt;break}}}if(Je){if(I[se[tr]]=I[se[Dr]]=Je,Je!==mt){for(var Ft=tr+1;Ft<se.length;Ft++)if(!(I[se[Ft]]&a)){h(j[se[Ft]])&re&&(I[se[Ft]]=Je);break}}if(Je!==mt){for(var Bt=Dr+1;Bt<se.length;Bt++)if(!(I[se[Bt]]&a)){h(j[se[Bt]])&re&&(I[se[Bt]]=Je);break}}}}for(var st=0;st<se.length;st++)if(I[se[st]]&s){for(var xn=st,Rr=st,Fr=Et,kt=st-1;kt>=0;kt--)if(I[se[kt]]&a)xn=kt;else{Fr=I[se[kt]]&At?w:_;break}for(var bn=Si,Pt=st+1;Pt<se.length;Pt++)if(I[se[Pt]]&(s|a))Rr=Pt;else{bn=I[se[Pt]]&At?w:_;break}for(var Br=xn;Br<=Rr;Br++)I[se[Br]]=Fr===bn?Fr:mt;st=Rr}}}for(var Ye=ae.start;Ye<=ae.end;Ye++){var wi=K[Ye],rr=I[Ye];if(wi&1?rr&(_|O|y)&&K[Ye]++:rr&w?K[Ye]++:rr&(y|O)&&(K[Ye]+=2),rr&a&&(K[Ye]=Ye===0?ae.level:K[Ye-1]),Ye===ae.end||h(j[Ye])&(W|M))for(var nr=Ye;nr>=0&&h(j[nr])&o;nr--)K[nr]=ae.level}}return{levels:K,paragraphs:ne};function Sn(je,Qe){for(var Ve=je;Ve<j.length;Ve++){var ot=I[Ve];if(ot&(w|G))return 1;if(ot&(M|_)||Qe&&ot===L)return 0;if(ot&e){var Tn=Ui(Ve);Ve=Tn===-1?j.length:Tn}}return 0}function Ui(je){for(var Qe=1,Ve=je+1;Ve<j.length;Ve++){var ot=I[Ve];if(ot&M)break;if(ot&L){if(--Qe===0)return Ve}else ot&e&&Qe++}return-1}}var $="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function N(){if(!V){var j=g($,!0),te=j.map,q=j.reverseMap;q.forEach(function(I,de){te.set(de,I)}),V=te}}function ge(j){return N(),V.get(j)||null}function fe(j,te,q,I){var de=j.length;q=Math.max(0,q==null?0:+q),I=Math.min(de-1,I==null?de-1:+I);for(var Z=new Map,ie=q;ie<=I;ie++)if(te[ie]&1){var K=ge(j[ie]);K!==null&&Z.set(ie,K)}return Z}function J(j,te,q,I){var de=j.length;q=Math.max(0,q==null?0:+q),I=Math.min(de-1,I==null?de-1:+I);var Z=[];return te.paragraphs.forEach(function(ie){var K=Math.max(q,ie.start),we=Math.min(I,ie.end);if(K<we){for(var ne=te.levels.slice(K,we+1),ae=we;ae>=K&&h(j[ae])&o;ae--)ne[ae]=ie.level;for(var ue=ie.level,ve=1/0,Me=0;Me<ne.length;Me++){var Fe=ne[Me];Fe>ue&&(ue=Fe),Fe<ve&&(ve=Fe|1)}for(var me=ue;me>=ve;me--)for(var ye=0;ye<ne.length;ye++)if(ne[ye]>=me){for(var le=ye;ye+1<ne.length&&ne[ye+1]>=me;)ye++;ye>le&&Z.push([le+K,ye+K])}}}),Z}function ee(j,te,q,I){var de=oe(j,te,q,I),Z=[].concat(j);return de.forEach(function(ie,K){Z[K]=(te.levels[ie]&1?ge(j[ie]):null)||j[ie]}),Z.join("")}function oe(j,te,q,I){for(var de=J(j,te,q,I),Z=[],ie=0;ie<j.length;ie++)Z[ie]=ie;return de.forEach(function(K){for(var we=K[0],ne=K[1],ae=Z.slice(we,ne+1),ue=ae.length;ue--;)Z[ne-ue]=ae[ue]}),Z}return t.closingToOpeningBracket=U,t.getBidiCharType=h,t.getBidiCharTypeName=d,t.getCanonicalBracket=P,t.getEmbeddingLevels=Y,t.getMirroredCharacter=ge,t.getMirroredCharactersMap=fe,t.getReorderSegments=J,t.getReorderedIndices=oe,t.getReorderedString=ee,t.openingToClosingBracket=b,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return n}const ii=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Nr(n){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function u(f,r){let e=Ai[r];return e?Nr(e):f}return n.replace(t,u)}const Ie=[];for(let n=0;n<256;n++)Ie[n]=(n<16?"0":"")+n.toString(16);function la(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,u=Math.random()*4294967295|0,f=Math.random()*4294967295|0;return(Ie[n&255]+Ie[n>>8&255]+Ie[n>>16&255]+Ie[n>>24&255]+"-"+Ie[t&255]+Ie[t>>8&255]+"-"+Ie[t>>16&15|64]+Ie[t>>24&255]+"-"+Ie[u&63|128]+Ie[u>>8&255]+"-"+Ie[u>>16&255]+Ie[u>>24&255]+Ie[f&255]+Ie[f>>8&255]+Ie[f>>16&255]+Ie[f>>24&255]).toUpperCase()}const ct=Object.assign||function(){let n=arguments[0];for(let t=1,u=arguments.length;t<u;t++){let f=arguments[t];if(f)for(let r in f)Object.prototype.hasOwnProperty.call(f,r)&&(n[r]=f[r])}return n},ua=Date.now(),En=new WeakMap,Mn=new Map;let fa=1e10;function Hr(n,t){const u=va(t);let f=En.get(n);if(f||En.set(n,f=Object.create(null)),f[u])return new f[u];const r=`_onBeforeCompile${u}`,e=function(o,l){n.onBeforeCompile.call(this,o,l);const c=this.customProgramCacheKey()+"|"+o.vertexShader+"|"+o.fragmentShader;let h=Mn[c];if(!h){const d=ca(this,o,t,u);h=Mn[c]=d}o.vertexShader=h.vertexShader,o.fragmentShader=h.fragmentShader,ct(o.uniforms,this.uniforms),t.timeUniform&&(o.uniforms[t.timeUniform]={get value(){return Date.now()-ua}}),this[r]&&this[r](o)},i=function(){return s(t.chained?n:n.clone())},s=function(o){const l=Object.create(o,a);return Object.defineProperty(l,"baseMaterial",{value:n}),Object.defineProperty(l,"id",{value:fa++}),l.uuid=la(),l.uniforms=ct({},o.uniforms,t.uniforms),l.defines=ct({},o.defines,t.defines),l.defines[`TROIKA_DERIVED_MATERIAL_${u}`]="",l.extensions=ct({},o.extensions,t.extensions),l._listeners=void 0,l},a={constructor:{value:i},isDerivedMaterial:{value:!0},type:{get:()=>n.type,set:o=>{n.type=o}},isDerivedFrom:{writable:!0,configurable:!0,value:function(o){const l=this.baseMaterial;return o===l||l.isDerivedMaterial&&l.isDerivedFrom(o)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return n.customProgramCacheKey()+"|"+u}},onBeforeCompile:{get(){return e},set(o){this[r]=o}},copy:{writable:!0,configurable:!0,value:function(o){return n.copy.call(this,o),!n.isShaderMaterial&&!n.isDerivedMaterial&&(ct(this.extensions,o.extensions),ct(this.defines,o.defines),ct(this.uniforms,Di.clone(o.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const o=new n.constructor;return s(o).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let o=this._depthMaterial;return o||(o=this._depthMaterial=Hr(n.isDerivedMaterial?n.getDepthMaterial():new Ei({depthPacking:Mi}),t),o.defines.IS_DEPTH_MATERIAL="",o.uniforms=this.uniforms),o}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let o=this._distanceMaterial;return o||(o=this._distanceMaterial=Hr(n.isDerivedMaterial?n.getDistanceMaterial():new _i,t),o.defines.IS_DISTANCE_MATERIAL="",o.uniforms=this.uniforms),o}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:o,_distanceMaterial:l}=this;o&&o.dispose(),l&&l.dispose(),n.dispose.call(this)}}};return f[u]=i,new i}function ca(n,{vertexShader:t,fragmentShader:u},f,r){let{vertexDefs:e,vertexMainIntro:i,vertexMainOutro:s,vertexTransform:a,fragmentDefs:o,fragmentMainIntro:l,fragmentMainOutro:c,fragmentColorTransform:h,customRewriter:d,timeUniform:v}=f;if(e=e||"",i=i||"",s=s||"",o=o||"",l=l||"",c=c||"",(a||d)&&(t=Nr(t)),(h||d)&&(u=u.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),u=Nr(u)),d){let g=d({vertexShader:t,fragmentShader:u});t=g.vertexShader,u=g.fragmentShader}if(h){let g=[];u=u.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(g.push(m),"")),c=`${h}
${g.join(`
`)}
${c}`}if(v){const g=`
uniform float ${v};
`;e=g+e,o=g+o}return a&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${a}
}
`,i=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${i}
`,t=t.replace(/\b(position|normal|uv)\b/g,(g,m,F,x)=>/\battribute\s+vec[23]\s+$/.test(x.substr(0,F))?m:`troika_${m}_${r}`),n.map&&n.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=Dn(t,r,e,i,s),u=Dn(u,r,o,l,c),{vertexShader:t,fragmentShader:u}}function Dn(n,t,u,f,r){return(f||r||u)&&(n=n.replace(ii,`
${u}
void troikaOrigMain${t}() {`),n+=`
void main() {
  ${f}
  troikaOrigMain${t}();
  ${r}
}`),n}function ha(n,t){return n==="uniforms"?void 0:typeof t=="function"?t.toString():t}let da=0;const An=new Map;function va(n){const t=JSON.stringify(n,ha);let u=An.get(t);return u==null&&An.set(t,u=++da),u}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function pa(){return typeof window>"u"&&(self.window=self),function(n){var t={parse:function(r){var e=t._bin,i=new Uint8Array(r);if(e.readASCII(i,0,4)=="ttcf"){var s=4;e.readUshort(i,s),s+=2,e.readUshort(i,s),s+=2;var a=e.readUint(i,s);s+=4;for(var o=[],l=0;l<a;l++){var c=e.readUint(i,s);s+=4,o.push(t._readFont(i,c))}return o}return[t._readFont(i,0)]},_readFont:function(r,e){var i=t._bin,s=e;i.readFixed(r,e),e+=4;var a=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],l={_data:r,_offset:s},c={},h=0;h<a;h++){var d=i.readASCII(r,e,4);e+=4,i.readUint(r,e),e+=4;var v=i.readUint(r,e);e+=4;var g=i.readUint(r,e);e+=4,c[d]={offset:v,length:g}}for(h=0;h<o.length;h++){var m=o[h];c[m]&&(l[m.trim()]=t[m.trim()].parse(r,c[m].offset,c[m].length,l))}return l},_tabOffset:function(r,e,i){for(var s=t._bin,a=s.readUshort(r,i+4),o=i+12,l=0;l<a;l++){var c=s.readASCII(r,o,4);o+=4,s.readUint(r,o),o+=4;var h=s.readUint(r,o);if(o+=4,s.readUint(r,o),o+=4,c==e)return h}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,i){for(var s=[],a=0;a<i;a++)s.push(t._bin.readUshort(r,e+2*a));return s},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,i){for(var s="",a=0;a<i;a++)s+=String.fromCharCode(r[e+a]);return s},readUnicode:function(r,e,i){for(var s="",a=0;a<i;a++){var o=r[e++]<<8|r[e++];s+=String.fromCharCode(o)}return s},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,i){var s=t._bin._tdec;return s&&e==0&&i==r.length?s.decode(r):t._bin.readASCII(r,e,i)},readBytes:function(r,e,i){for(var s=[],a=0;a<i;a++)s.push(r[e+a]);return s},readASCIIArray:function(r,e,i){for(var s=[],a=0;a<i;a++)s.push(String.fromCharCode(r[e+a]));return s},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,i,s,a){var o=t._bin,l={},c=e;o.readFixed(r,e),e+=4;var h=o.readUshort(r,e);e+=2;var d=o.readUshort(r,e);e+=2;var v=o.readUshort(r,e);return e+=2,l.scriptList=t._lctf.readScriptList(r,c+h),l.featureList=t._lctf.readFeatureList(r,c+d),l.lookupList=t._lctf.readLookupList(r,c+v,a),l},t._lctf.readLookupList=function(r,e,i){var s=t._bin,a=e,o=[],l=s.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var h=s.readUshort(r,e);e+=2;var d=t._lctf.readLookupTable(r,a+h,i);o.push(d)}return o},t._lctf.readLookupTable=function(r,e,i){var s=t._bin,a=e,o={tabs:[]};o.ltype=s.readUshort(r,e),e+=2,o.flag=s.readUshort(r,e),e+=2;var l=s.readUshort(r,e);e+=2;for(var c=o.ltype,h=0;h<l;h++){var d=s.readUshort(r,e);e+=2;var v=i(r,c,a+d,o);o.tabs.push(v)}return o},t._lctf.numOfOnes=function(r){for(var e=0,i=0;i<32;i++)(r>>>i&1)!=0&&e++;return e},t._lctf.readClassDef=function(r,e){var i=t._bin,s=[],a=i.readUshort(r,e);if(e+=2,a==1){var o=i.readUshort(r,e);e+=2;var l=i.readUshort(r,e);e+=2;for(var c=0;c<l;c++)s.push(o+c),s.push(o+c),s.push(i.readUshort(r,e)),e+=2}if(a==2){var h=i.readUshort(r,e);for(e+=2,c=0;c<h;c++)s.push(i.readUshort(r,e)),e+=2,s.push(i.readUshort(r,e)),e+=2,s.push(i.readUshort(r,e)),e+=2}return s},t._lctf.getInterval=function(r,e){for(var i=0;i<r.length;i+=3){var s=r[i],a=r[i+1];if(r[i+2],s<=e&&e<=a)return i}return-1},t._lctf.readCoverage=function(r,e){var i=t._bin,s={};s.fmt=i.readUshort(r,e),e+=2;var a=i.readUshort(r,e);return e+=2,s.fmt==1&&(s.tab=i.readUshorts(r,e,a)),s.fmt==2&&(s.tab=i.readUshorts(r,e,3*a)),s},t._lctf.coverageIndex=function(r,e){var i=r.tab;if(r.fmt==1)return i.indexOf(e);if(r.fmt==2){var s=t._lctf.getInterval(i,e);if(s!=-1)return i[s+2]+(e-i[s])}return-1},t._lctf.readFeatureList=function(r,e){var i=t._bin,s=e,a=[],o=i.readUshort(r,e);e+=2;for(var l=0;l<o;l++){var c=i.readASCII(r,e,4);e+=4;var h=i.readUshort(r,e);e+=2;var d=t._lctf.readFeatureTable(r,s+h);d.tag=c.trim(),a.push(d)}return a},t._lctf.readFeatureTable=function(r,e){var i=t._bin,s=e,a={},o=i.readUshort(r,e);e+=2,o>0&&(a.featureParams=s+o);var l=i.readUshort(r,e);e+=2,a.tab=[];for(var c=0;c<l;c++)a.tab.push(i.readUshort(r,e+2*c));return a},t._lctf.readScriptList=function(r,e){var i=t._bin,s=e,a={},o=i.readUshort(r,e);e+=2;for(var l=0;l<o;l++){var c=i.readASCII(r,e,4);e+=4;var h=i.readUshort(r,e);e+=2,a[c.trim()]=t._lctf.readScriptTable(r,s+h)}return a},t._lctf.readScriptTable=function(r,e){var i=t._bin,s=e,a={},o=i.readUshort(r,e);e+=2,o>0&&(a.default=t._lctf.readLangSysTable(r,s+o));var l=i.readUshort(r,e);e+=2;for(var c=0;c<l;c++){var h=i.readASCII(r,e,4);e+=4;var d=i.readUshort(r,e);e+=2,a[h.trim()]=t._lctf.readLangSysTable(r,s+d)}return a},t._lctf.readLangSysTable=function(r,e){var i=t._bin,s={};i.readUshort(r,e),e+=2,s.reqFeature=i.readUshort(r,e),e+=2;var a=i.readUshort(r,e);return e+=2,s.features=i.readUshorts(r,e,a),s},t.CFF={},t.CFF.parse=function(r,e,i){var s=t._bin;(r=new Uint8Array(r.buffer,e,i))[e=0],r[++e],r[++e],r[++e],e++;var a=[];e=t.CFF.readIndex(r,e,a);for(var o=[],l=0;l<a.length-1;l++)o.push(s.readASCII(r,e+a[l],a[l+1]-a[l]));e+=a[a.length-1];var c=[];e=t.CFF.readIndex(r,e,c);var h=[];for(l=0;l<c.length-1;l++)h.push(t.CFF.readDict(r,e+c[l],e+c[l+1]));e+=c[c.length-1];var d=h[0],v=[];e=t.CFF.readIndex(r,e,v);var g=[];for(l=0;l<v.length-1;l++)g.push(s.readASCII(r,e+v[l],v[l+1]-v[l]));if(e+=v[v.length-1],t.CFF.readSubrs(r,e,d),d.CharStrings){e=d.CharStrings,v=[],e=t.CFF.readIndex(r,e,v);var m=[];for(l=0;l<v.length-1;l++)m.push(s.readBytes(r,e+v[l],v[l+1]-v[l]));d.CharStrings=m}if(d.ROS){e=d.FDArray;var F=[];for(e=t.CFF.readIndex(r,e,F),d.FDArray=[],l=0;l<F.length-1;l++){var x=t.CFF.readDict(r,e+F[l],e+F[l+1]);t.CFF._readFDict(r,x,g),d.FDArray.push(x)}e+=F[F.length-1],e=d.FDSelect,d.FDSelect=[];var S=r[e];if(e++,S!=3)throw S;var b=s.readUshort(r,e);for(e+=2,l=0;l<b+1;l++)d.FDSelect.push(s.readUshort(r,e),r[e+2]),e+=3}return d.Encoding&&(d.Encoding=t.CFF.readEncoding(r,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=t.CFF.readCharset(r,d.charset,d.CharStrings.length)),t.CFF._readFDict(r,d,g),d},t.CFF._readFDict=function(r,e,i){var s;for(var a in e.Private&&(s=e.Private[1],e.Private=t.CFF.readDict(r,s,s+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,s+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)!=-1&&(e[a]=i[e[a]-426+35])},t.CFF.readSubrs=function(r,e,i){var s=t._bin,a=[];e=t.CFF.readIndex(r,e,a);var o,l=a.length;o=l<1240?107:l<33900?1131:32768,i.Bias=o,i.Subrs=[];for(var c=0;c<a.length-1;c++)i.Subrs.push(s.readBytes(r,e+a[c],a[c+1]-a[c]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var i=0;i<r.charset.length;i++)if(r.charset[i]==e)return i;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,i){t._bin;var s=[".notdef"],a=r[e];if(e++,a!=0)throw"error: unknown encoding format: "+a;var o=r[e];e++;for(var l=0;l<o;l++)s.push(r[e+l]);return s},t.CFF.readCharset=function(r,e,i){var s=t._bin,a=[".notdef"],o=r[e];if(e++,o==0)for(var l=0;l<i;l++){var c=s.readUshort(r,e);e+=2,a.push(c)}else{if(o!=1&&o!=2)throw"error: format: "+o;for(;a.length<i;){c=s.readUshort(r,e),e+=2;var h=0;for(o==1?(h=r[e],e++):(h=s.readUshort(r,e),e+=2),l=0;l<=h;l++)a.push(c),c++}}return a},t.CFF.readIndex=function(r,e,i){var s=t._bin,a=s.readUshort(r,e)+1,o=r[e+=2];if(e++,o==1)for(var l=0;l<a;l++)i.push(r[e+l]);else if(o==2)for(l=0;l<a;l++)i.push(s.readUshort(r,e+2*l));else if(o==3)for(l=0;l<a;l++)i.push(16777215&s.readUint(r,e+3*l-1));else if(a!=1)throw"unsupported offset size: "+o+", count: "+a;return(e+=a*o)-1},t.CFF.getCharString=function(r,e,i){var s=t._bin,a=r[e],o=r[e+1];r[e+2],r[e+3],r[e+4];var l=1,c=null,h=null;a<=20&&(c=a,l=1),a==12&&(c=100*a+o,l=2),21<=a&&a<=27&&(c=a,l=1),a==28&&(h=s.readShort(r,e+1),l=3),29<=a&&a<=31&&(c=a,l=1),32<=a&&a<=246&&(h=a-139,l=1),247<=a&&a<=250&&(h=256*(a-247)+o+108,l=2),251<=a&&a<=254&&(h=256*-(a-251)-o-108,l=2),a==255&&(h=s.readInt(r,e+1)/65535,l=5),i.val=h??"o"+c,i.size=l},t.CFF.readCharString=function(r,e,i){for(var s=e+i,a=t._bin,o=[];e<s;){var l=r[e],c=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,v=null;l<=20&&(d=l,h=1),l==12&&(d=100*l+c,h=2),l!=19&&l!=20||(d=l,h=2),21<=l&&l<=27&&(d=l,h=1),l==28&&(v=a.readShort(r,e+1),h=3),29<=l&&l<=31&&(d=l,h=1),32<=l&&l<=246&&(v=l-139,h=1),247<=l&&l<=250&&(v=256*(l-247)+c+108,h=2),251<=l&&l<=254&&(v=256*-(l-251)-c-108,h=2),l==255&&(v=a.readInt(r,e+1)/65535,h=5),o.push(v??"o"+d),e+=h}return o},t.CFF.readDict=function(r,e,i){for(var s=t._bin,a={},o=[];e<i;){var l=r[e],c=r[e+1];r[e+2],r[e+3],r[e+4];var h=1,d=null,v=null;if(l==28&&(v=s.readShort(r,e+1),h=3),l==29&&(v=s.readInt(r,e+1),h=5),32<=l&&l<=246&&(v=l-139,h=1),247<=l&&l<=250&&(v=256*(l-247)+c+108,h=2),251<=l&&l<=254&&(v=256*-(l-251)-c-108,h=2),l==255)throw v=s.readInt(r,e+1)/65535,h=5,"unknown number";if(l==30){var g=[];for(h=1;;){var m=r[e+h];h++;var F=m>>4,x=15&m;if(F!=15&&g.push(F),x!=15&&g.push(x),x==15)break}for(var S="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],U=0;U<g.length;U++)S+=b[g[U]];v=parseFloat(S)}l<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][l],h=1,l==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][c],h=2)),d!=null?(a[d]=o.length==1?o[0]:o,o=[]):o.push(v),e+=h}return a},t.cmap={},t.cmap.parse=function(r,e,i){r=new Uint8Array(r.buffer,e,i),e=0;var s=t._bin,a={};s.readUshort(r,e),e+=2;var o=s.readUshort(r,e);e+=2;var l=[];a.tables=[];for(var c=0;c<o;c++){var h=s.readUshort(r,e);e+=2;var d=s.readUshort(r,e);e+=2;var v=s.readUint(r,e);e+=4;var g="p"+h+"e"+d,m=l.indexOf(v);if(m==-1){var F;m=a.tables.length,l.push(v);var x=s.readUshort(r,v);x==0?F=t.cmap.parse0(r,v):x==4?F=t.cmap.parse4(r,v):x==6?F=t.cmap.parse6(r,v):x==12?F=t.cmap.parse12(r,v):console.debug("unknown format: "+x,h,d,v),a.tables.push(F)}if(a[g]!=null)throw"multiple tables for one platform+encoding";a[g]=m}return a},t.cmap.parse0=function(r,e){var i=t._bin,s={};s.format=i.readUshort(r,e),e+=2;var a=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2,s.map=[];for(var o=0;o<a-6;o++)s.map.push(r[e+o]);return s},t.cmap.parse4=function(r,e){var i=t._bin,s=e,a={};a.format=i.readUshort(r,e),e+=2;var o=i.readUshort(r,e);e+=2,i.readUshort(r,e),e+=2;var l=i.readUshort(r,e);e+=2;var c=l/2;a.searchRange=i.readUshort(r,e),e+=2,a.entrySelector=i.readUshort(r,e),e+=2,a.rangeShift=i.readUshort(r,e),e+=2,a.endCount=i.readUshorts(r,e,c),e+=2*c,e+=2,a.startCount=i.readUshorts(r,e,c),e+=2*c,a.idDelta=[];for(var h=0;h<c;h++)a.idDelta.push(i.readShort(r,e)),e+=2;for(a.idRangeOffset=i.readUshorts(r,e,c),e+=2*c,a.glyphIdArray=[];e<s+o;)a.glyphIdArray.push(i.readUshort(r,e)),e+=2;return a},t.cmap.parse6=function(r,e){var i=t._bin,s={};s.format=i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,i.readUshort(r,e),e+=2,s.firstCode=i.readUshort(r,e),e+=2;var a=i.readUshort(r,e);e+=2,s.glyphIdArray=[];for(var o=0;o<a;o++)s.glyphIdArray.push(i.readUshort(r,e)),e+=2;return s},t.cmap.parse12=function(r,e){var i=t._bin,s={};s.format=i.readUshort(r,e),e+=2,e+=2,i.readUint(r,e),e+=4,i.readUint(r,e),e+=4;var a=i.readUint(r,e);e+=4,s.groups=[];for(var o=0;o<a;o++){var l=e+12*o,c=i.readUint(r,l+0),h=i.readUint(r,l+4),d=i.readUint(r,l+8);s.groups.push([c,h,d])}return s},t.glyf={},t.glyf.parse=function(r,e,i,s){for(var a=[],o=0;o<s.maxp.numGlyphs;o++)a.push(null);return a},t.glyf._parseGlyf=function(r,e){var i=t._bin,s=r._data,a=t._tabOffset(s,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var o={};if(o.noc=i.readShort(s,a),a+=2,o.xMin=i.readShort(s,a),a+=2,o.yMin=i.readShort(s,a),a+=2,o.xMax=i.readShort(s,a),a+=2,o.yMax=i.readShort(s,a),a+=2,o.xMin>=o.xMax||o.yMin>=o.yMax)return null;if(o.noc>0){o.endPts=[];for(var l=0;l<o.noc;l++)o.endPts.push(i.readUshort(s,a)),a+=2;var c=i.readUshort(s,a);if(a+=2,s.length-a<c)return null;o.instructions=i.readBytes(s,a,c),a+=c;var h=o.endPts[o.noc-1]+1;for(o.flags=[],l=0;l<h;l++){var d=s[a];if(a++,o.flags.push(d),(8&d)!=0){var v=s[a];a++;for(var g=0;g<v;g++)o.flags.push(d),l++}}for(o.xs=[],l=0;l<h;l++){var m=(2&o.flags[l])!=0,F=(16&o.flags[l])!=0;m?(o.xs.push(F?s[a]:-s[a]),a++):F?o.xs.push(0):(o.xs.push(i.readShort(s,a)),a+=2)}for(o.ys=[],l=0;l<h;l++)m=(4&o.flags[l])!=0,F=(32&o.flags[l])!=0,m?(o.ys.push(F?s[a]:-s[a]),a++):F?o.ys.push(0):(o.ys.push(i.readShort(s,a)),a+=2);var x=0,S=0;for(l=0;l<h;l++)x+=o.xs[l],S+=o.ys[l],o.xs[l]=x,o.ys[l]=S}else{var b;o.parts=[];do{b=i.readUshort(s,a),a+=2;var U={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(o.parts.push(U),U.glyphIndex=i.readUshort(s,a),a+=2,1&b){var P=i.readShort(s,a);a+=2;var _=i.readShort(s,a);a+=2}else P=i.readInt8(s,a),a++,_=i.readInt8(s,a),a++;2&b?(U.m.tx=P,U.m.ty=_):(U.p1=P,U.p2=_),8&b?(U.m.a=U.m.d=i.readF2dot14(s,a),a+=2):64&b?(U.m.a=i.readF2dot14(s,a),a+=2,U.m.d=i.readF2dot14(s,a),a+=2):128&b&&(U.m.a=i.readF2dot14(s,a),a+=2,U.m.b=i.readF2dot14(s,a),a+=2,U.m.c=i.readF2dot14(s,a),a+=2,U.m.d=i.readF2dot14(s,a),a+=2)}while(32&b);if(256&b){var w=i.readUshort(s,a);for(a+=2,o.instr=[],l=0;l<w;l++)o.instr.push(s[a]),a++}}return o},t.GDEF={},t.GDEF.parse=function(r,e,i,s){var a=e;e+=4;var o=t._bin.readUshort(r,e);return{glyphClassDef:o===0?null:t._lctf.readClassDef(r,a+o)}},t.GPOS={},t.GPOS.parse=function(r,e,i,s){return t._lctf.parse(r,e,i,s,t.GPOS.subt)},t.GPOS.subt=function(r,e,i,s){var a=t._bin,o=i,l={};if(l.fmt=a.readUshort(r,i),i+=2,e==1||e==2||e==3||e==7||e==8&&l.fmt<=2){var c=a.readUshort(r,i);i+=2,l.coverage=t._lctf.readCoverage(r,c+o)}if(e==1&&l.fmt==1){var h=a.readUshort(r,i);i+=2,h!=0&&(l.pos=t.GPOS.readValueRecord(r,i,h))}else if(e==2&&l.fmt>=1&&l.fmt<=2){h=a.readUshort(r,i),i+=2;var d=a.readUshort(r,i);i+=2;var v=t._lctf.numOfOnes(h),g=t._lctf.numOfOnes(d);if(l.fmt==1){l.pairsets=[];var m=a.readUshort(r,i);i+=2;for(var F=0;F<m;F++){var x=o+a.readUshort(r,i);i+=2;var S=a.readUshort(r,x);x+=2;for(var b=[],U=0;U<S;U++){var P=a.readUshort(r,x);x+=2,h!=0&&(y=t.GPOS.readValueRecord(r,x,h),x+=2*v),d!=0&&(R=t.GPOS.readValueRecord(r,x,d),x+=2*g),b.push({gid2:P,val1:y,val2:R})}l.pairsets.push(b)}}if(l.fmt==2){var _=a.readUshort(r,i);i+=2;var w=a.readUshort(r,i);i+=2;var O=a.readUshort(r,i);i+=2;var C=a.readUshort(r,i);for(i+=2,l.classDef1=t._lctf.readClassDef(r,o+_),l.classDef2=t._lctf.readClassDef(r,o+w),l.matrix=[],F=0;F<O;F++){var X=[];for(U=0;U<C;U++){var y=null,R=null;h!=0&&(y=t.GPOS.readValueRecord(r,i,h),i+=2*v),d!=0&&(R=t.GPOS.readValueRecord(r,i,d),i+=2*g),X.push({val1:y,val2:R})}l.matrix.push(X)}}}else if(e==4&&l.fmt==1)l.markCoverage=t._lctf.readCoverage(r,a.readUshort(r,i)+o),l.baseCoverage=t._lctf.readCoverage(r,a.readUshort(r,i+2)+o),l.markClassCount=a.readUshort(r,i+4),l.markArray=t.GPOS.readMarkArray(r,a.readUshort(r,i+6)+o),l.baseArray=t.GPOS.readBaseArray(r,a.readUshort(r,i+8)+o,l.markClassCount);else if(e==6&&l.fmt==1)l.mark1Coverage=t._lctf.readCoverage(r,a.readUshort(r,i)+o),l.mark2Coverage=t._lctf.readCoverage(r,a.readUshort(r,i+2)+o),l.markClassCount=a.readUshort(r,i+4),l.mark1Array=t.GPOS.readMarkArray(r,a.readUshort(r,i+6)+o),l.mark2Array=t.GPOS.readBaseArray(r,a.readUshort(r,i+8)+o,l.markClassCount);else{if(e==9&&l.fmt==1){var M=a.readUshort(r,i);i+=2;var W=a.readUint(r,i);if(i+=4,s.ltype==9)s.ltype=M;else if(s.ltype!=M)throw"invalid extension substitution";return t.GPOS.subt(r,s.ltype,o+W)}console.debug("unsupported GPOS table LookupType",e,"format",l.fmt)}return l},t.GPOS.readValueRecord=function(r,e,i){var s=t._bin,a=[];return a.push(1&i?s.readShort(r,e):0),e+=1&i?2:0,a.push(2&i?s.readShort(r,e):0),e+=2&i?2:0,a.push(4&i?s.readShort(r,e):0),e+=4&i?2:0,a.push(8&i?s.readShort(r,e):0),e+=8&i?2:0,a},t.GPOS.readBaseArray=function(r,e,i){var s=t._bin,a=[],o=e,l=s.readUshort(r,e);e+=2;for(var c=0;c<l;c++){for(var h=[],d=0;d<i;d++)h.push(t.GPOS.readAnchorRecord(r,o+s.readUshort(r,e))),e+=2;a.push(h)}return a},t.GPOS.readMarkArray=function(r,e){var i=t._bin,s=[],a=e,o=i.readUshort(r,e);e+=2;for(var l=0;l<o;l++){var c=t.GPOS.readAnchorRecord(r,i.readUshort(r,e+2)+a);c.markClass=i.readUshort(r,e),s.push(c),e+=4}return s},t.GPOS.readAnchorRecord=function(r,e){var i=t._bin,s={};return s.fmt=i.readUshort(r,e),s.x=i.readShort(r,e+2),s.y=i.readShort(r,e+4),s},t.GSUB={},t.GSUB.parse=function(r,e,i,s){return t._lctf.parse(r,e,i,s,t.GSUB.subt)},t.GSUB.subt=function(r,e,i,s){var a=t._bin,o=i,l={};if(l.fmt=a.readUshort(r,i),i+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&l.fmt<=2||e==6&&l.fmt<=2){var c=a.readUshort(r,i);i+=2,l.coverage=t._lctf.readCoverage(r,o+c)}if(e==1&&l.fmt>=1&&l.fmt<=2){if(l.fmt==1)l.delta=a.readShort(r,i),i+=2;else if(l.fmt==2){var h=a.readUshort(r,i);i+=2,l.newg=a.readUshorts(r,i,h),i+=2*l.newg.length}}else if(e==2&&l.fmt==1){h=a.readUshort(r,i),i+=2,l.seqs=[];for(var d=0;d<h;d++){var v=a.readUshort(r,i)+o;i+=2;var g=a.readUshort(r,v);l.seqs.push(a.readUshorts(r,v+2,g))}}else if(e==4)for(l.vals=[],h=a.readUshort(r,i),i+=2,d=0;d<h;d++){var m=a.readUshort(r,i);i+=2,l.vals.push(t.GSUB.readLigatureSet(r,o+m))}else if(e==5&&l.fmt==2){if(l.fmt==2){var F=a.readUshort(r,i);i+=2,l.cDef=t._lctf.readClassDef(r,o+F),l.scset=[];var x=a.readUshort(r,i);for(i+=2,d=0;d<x;d++){var S=a.readUshort(r,i);i+=2,l.scset.push(S==0?null:t.GSUB.readSubClassSet(r,o+S))}}}else if(e==6&&l.fmt==3){if(l.fmt==3){for(d=0;d<3;d++){h=a.readUshort(r,i),i+=2;for(var b=[],U=0;U<h;U++)b.push(t._lctf.readCoverage(r,o+a.readUshort(r,i+2*U)));i+=2*h,d==0&&(l.backCvg=b),d==1&&(l.inptCvg=b),d==2&&(l.ahedCvg=b)}h=a.readUshort(r,i),i+=2,l.lookupRec=t.GSUB.readSubstLookupRecords(r,i,h)}}else{if(e==7&&l.fmt==1){var P=a.readUshort(r,i);i+=2;var _=a.readUint(r,i);if(i+=4,s.ltype==9)s.ltype=P;else if(s.ltype!=P)throw"invalid extension substitution";return t.GSUB.subt(r,s.ltype,o+_)}console.debug("unsupported GSUB table LookupType",e,"format",l.fmt)}return l},t.GSUB.readSubClassSet=function(r,e){var i=t._bin.readUshort,s=e,a=[],o=i(r,e);e+=2;for(var l=0;l<o;l++){var c=i(r,e);e+=2,a.push(t.GSUB.readSubClassRule(r,s+c))}return a},t.GSUB.readSubClassRule=function(r,e){var i=t._bin.readUshort,s={},a=i(r,e),o=i(r,e+=2);e+=2,s.input=[];for(var l=0;l<a-1;l++)s.input.push(i(r,e)),e+=2;return s.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,o),s},t.GSUB.readSubstLookupRecords=function(r,e,i){for(var s=t._bin.readUshort,a=[],o=0;o<i;o++)a.push(s(r,e),s(r,e+2)),e+=4;return a},t.GSUB.readChainSubClassSet=function(r,e){var i=t._bin,s=e,a=[],o=i.readUshort(r,e);e+=2;for(var l=0;l<o;l++){var c=i.readUshort(r,e);e+=2,a.push(t.GSUB.readChainSubClassRule(r,s+c))}return a},t.GSUB.readChainSubClassRule=function(r,e){for(var i=t._bin,s={},a=["backtrack","input","lookahead"],o=0;o<a.length;o++){var l=i.readUshort(r,e);e+=2,o==1&&l--,s[a[o]]=i.readUshorts(r,e,l),e+=2*s[a[o]].length}return l=i.readUshort(r,e),e+=2,s.subst=i.readUshorts(r,e,2*l),e+=2*s.subst.length,s},t.GSUB.readLigatureSet=function(r,e){var i=t._bin,s=e,a=[],o=i.readUshort(r,e);e+=2;for(var l=0;l<o;l++){var c=i.readUshort(r,e);e+=2,a.push(t.GSUB.readLigature(r,s+c))}return a},t.GSUB.readLigature=function(r,e){var i=t._bin,s={chain:[]};s.nglyph=i.readUshort(r,e),e+=2;var a=i.readUshort(r,e);e+=2;for(var o=0;o<a-1;o++)s.chain.push(i.readUshort(r,e)),e+=2;return s},t.head={},t.head.parse=function(r,e,i){var s=t._bin,a={};return s.readFixed(r,e),e+=4,a.fontRevision=s.readFixed(r,e),e+=4,s.readUint(r,e),e+=4,s.readUint(r,e),e+=4,a.flags=s.readUshort(r,e),e+=2,a.unitsPerEm=s.readUshort(r,e),e+=2,a.created=s.readUint64(r,e),e+=8,a.modified=s.readUint64(r,e),e+=8,a.xMin=s.readShort(r,e),e+=2,a.yMin=s.readShort(r,e),e+=2,a.xMax=s.readShort(r,e),e+=2,a.yMax=s.readShort(r,e),e+=2,a.macStyle=s.readUshort(r,e),e+=2,a.lowestRecPPEM=s.readUshort(r,e),e+=2,a.fontDirectionHint=s.readShort(r,e),e+=2,a.indexToLocFormat=s.readShort(r,e),e+=2,a.glyphDataFormat=s.readShort(r,e),e+=2,a},t.hhea={},t.hhea.parse=function(r,e,i){var s=t._bin,a={};return s.readFixed(r,e),e+=4,a.ascender=s.readShort(r,e),e+=2,a.descender=s.readShort(r,e),e+=2,a.lineGap=s.readShort(r,e),e+=2,a.advanceWidthMax=s.readUshort(r,e),e+=2,a.minLeftSideBearing=s.readShort(r,e),e+=2,a.minRightSideBearing=s.readShort(r,e),e+=2,a.xMaxExtent=s.readShort(r,e),e+=2,a.caretSlopeRise=s.readShort(r,e),e+=2,a.caretSlopeRun=s.readShort(r,e),e+=2,a.caretOffset=s.readShort(r,e),e+=2,e+=8,a.metricDataFormat=s.readShort(r,e),e+=2,a.numberOfHMetrics=s.readUshort(r,e),e+=2,a},t.hmtx={},t.hmtx.parse=function(r,e,i,s){for(var a=t._bin,o={aWidth:[],lsBearing:[]},l=0,c=0,h=0;h<s.maxp.numGlyphs;h++)h<s.hhea.numberOfHMetrics&&(l=a.readUshort(r,e),e+=2,c=a.readShort(r,e),e+=2),o.aWidth.push(l),o.lsBearing.push(c);return o},t.kern={},t.kern.parse=function(r,e,i,s){var a=t._bin,o=a.readUshort(r,e);if(e+=2,o==1)return t.kern.parseV1(r,e-2,i,s);var l=a.readUshort(r,e);e+=2;for(var c={glyph1:[],rval:[]},h=0;h<l;h++){e+=2,i=a.readUshort(r,e),e+=2;var d=a.readUshort(r,e);e+=2;var v=d>>>8;if((v&=15)!=0)throw"unknown kern table format: "+v;e=t.kern.readFormat0(r,e,c)}return c},t.kern.parseV1=function(r,e,i,s){var a=t._bin;a.readFixed(r,e),e+=4;var o=a.readUint(r,e);e+=4;for(var l={glyph1:[],rval:[]},c=0;c<o;c++){a.readUint(r,e),e+=4;var h=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2;var d=h>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=t.kern.readFormat0(r,e,l)}return l},t.kern.readFormat0=function(r,e,i){var s=t._bin,a=-1,o=s.readUshort(r,e);e+=2,s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2,s.readUshort(r,e),e+=2;for(var l=0;l<o;l++){var c=s.readUshort(r,e);e+=2;var h=s.readUshort(r,e);e+=2;var d=s.readShort(r,e);e+=2,c!=a&&(i.glyph1.push(c),i.rval.push({glyph2:[],vals:[]}));var v=i.rval[i.rval.length-1];v.glyph2.push(h),v.vals.push(d),a=c}return e},t.loca={},t.loca.parse=function(r,e,i,s){var a=t._bin,o=[],l=s.head.indexToLocFormat,c=s.maxp.numGlyphs+1;if(l==0)for(var h=0;h<c;h++)o.push(a.readUshort(r,e+(h<<1))<<1);if(l==1)for(h=0;h<c;h++)o.push(a.readUint(r,e+(h<<2)));return o},t.maxp={},t.maxp.parse=function(r,e,i){var s=t._bin,a={},o=s.readUint(r,e);return e+=4,a.numGlyphs=s.readUshort(r,e),e+=2,o==65536&&(a.maxPoints=s.readUshort(r,e),e+=2,a.maxContours=s.readUshort(r,e),e+=2,a.maxCompositePoints=s.readUshort(r,e),e+=2,a.maxCompositeContours=s.readUshort(r,e),e+=2,a.maxZones=s.readUshort(r,e),e+=2,a.maxTwilightPoints=s.readUshort(r,e),e+=2,a.maxStorage=s.readUshort(r,e),e+=2,a.maxFunctionDefs=s.readUshort(r,e),e+=2,a.maxInstructionDefs=s.readUshort(r,e),e+=2,a.maxStackElements=s.readUshort(r,e),e+=2,a.maxSizeOfInstructions=s.readUshort(r,e),e+=2,a.maxComponentElements=s.readUshort(r,e),e+=2,a.maxComponentDepth=s.readUshort(r,e),e+=2),a},t.name={},t.name.parse=function(r,e,i){var s=t._bin,a={};s.readUshort(r,e),e+=2;var o=s.readUshort(r,e);e+=2,s.readUshort(r,e);for(var l,c=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=e+=2,d=0;d<o;d++){var v=s.readUshort(r,e);e+=2;var g=s.readUshort(r,e);e+=2;var m=s.readUshort(r,e);e+=2;var F=s.readUshort(r,e);e+=2;var x=s.readUshort(r,e);e+=2;var S=s.readUshort(r,e);e+=2;var b,U=c[F],P=h+12*o+S;if(v==0)b=s.readUnicode(r,P,x/2);else if(v==3&&g==0)b=s.readUnicode(r,P,x/2);else if(g==0)b=s.readASCII(r,P,x);else if(g==1)b=s.readUnicode(r,P,x/2);else if(g==3)b=s.readUnicode(r,P,x/2);else{if(v!=1)throw"unknown encoding "+g+", platformID: "+v;b=s.readASCII(r,P,x),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var _="p"+v+","+m.toString(16);a[_]==null&&(a[_]={}),a[_][U!==void 0?U:F]=b,a[_]._lang=m}for(var w in a)if(a[w].postScriptName!=null&&a[w]._lang==1033)return a[w];for(var w in a)if(a[w].postScriptName!=null&&a[w]._lang==0)return a[w];for(var w in a)if(a[w].postScriptName!=null&&a[w]._lang==3084)return a[w];for(var w in a)if(a[w].postScriptName!=null)return a[w];for(var w in a){l=w;break}return console.debug("returning name table with languageID "+a[l]._lang),a[l]},t["OS/2"]={},t["OS/2"].parse=function(r,e,i){var s=t._bin.readUshort(r,e);e+=2;var a={};if(s==0)t["OS/2"].version0(r,e,a);else if(s==1)t["OS/2"].version1(r,e,a);else if(s==2||s==3||s==4)t["OS/2"].version2(r,e,a);else{if(s!=5)throw"unknown OS/2 table version: "+s;t["OS/2"].version5(r,e,a)}return a},t["OS/2"].version0=function(r,e,i){var s=t._bin;return i.xAvgCharWidth=s.readShort(r,e),e+=2,i.usWeightClass=s.readUshort(r,e),e+=2,i.usWidthClass=s.readUshort(r,e),e+=2,i.fsType=s.readUshort(r,e),e+=2,i.ySubscriptXSize=s.readShort(r,e),e+=2,i.ySubscriptYSize=s.readShort(r,e),e+=2,i.ySubscriptXOffset=s.readShort(r,e),e+=2,i.ySubscriptYOffset=s.readShort(r,e),e+=2,i.ySuperscriptXSize=s.readShort(r,e),e+=2,i.ySuperscriptYSize=s.readShort(r,e),e+=2,i.ySuperscriptXOffset=s.readShort(r,e),e+=2,i.ySuperscriptYOffset=s.readShort(r,e),e+=2,i.yStrikeoutSize=s.readShort(r,e),e+=2,i.yStrikeoutPosition=s.readShort(r,e),e+=2,i.sFamilyClass=s.readShort(r,e),e+=2,i.panose=s.readBytes(r,e,10),e+=10,i.ulUnicodeRange1=s.readUint(r,e),e+=4,i.ulUnicodeRange2=s.readUint(r,e),e+=4,i.ulUnicodeRange3=s.readUint(r,e),e+=4,i.ulUnicodeRange4=s.readUint(r,e),e+=4,i.achVendID=[s.readInt8(r,e),s.readInt8(r,e+1),s.readInt8(r,e+2),s.readInt8(r,e+3)],e+=4,i.fsSelection=s.readUshort(r,e),e+=2,i.usFirstCharIndex=s.readUshort(r,e),e+=2,i.usLastCharIndex=s.readUshort(r,e),e+=2,i.sTypoAscender=s.readShort(r,e),e+=2,i.sTypoDescender=s.readShort(r,e),e+=2,i.sTypoLineGap=s.readShort(r,e),e+=2,i.usWinAscent=s.readUshort(r,e),e+=2,i.usWinDescent=s.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,i){var s=t._bin;return e=t["OS/2"].version0(r,e,i),i.ulCodePageRange1=s.readUint(r,e),e+=4,i.ulCodePageRange2=s.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,i){var s=t._bin;return e=t["OS/2"].version1(r,e,i),i.sxHeight=s.readShort(r,e),e+=2,i.sCapHeight=s.readShort(r,e),e+=2,i.usDefault=s.readUshort(r,e),e+=2,i.usBreak=s.readUshort(r,e),e+=2,i.usMaxContext=s.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,i){var s=t._bin;return e=t["OS/2"].version2(r,e,i),i.usLowerOpticalPointSize=s.readUshort(r,e),e+=2,i.usUpperOpticalPointSize=s.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,i){var s=t._bin,a={};return a.version=s.readFixed(r,e),e+=4,a.italicAngle=s.readFixed(r,e),e+=4,a.underlinePosition=s.readShort(r,e),e+=2,a.underlineThickness=s.readShort(r,e),e+=2,a},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var i=r.cmap,s=-1;if(i.p0e4!=null?s=i.p0e4:i.p3e1!=null?s=i.p3e1:i.p1e0!=null?s=i.p1e0:i.p0e3!=null&&(s=i.p0e3),s==-1)throw"no familiar platform and encoding!";var a=i.tables[s];if(a.format==0)return e>=a.map.length?0:a.map[e];if(a.format==4){for(var o=-1,l=0;l<a.endCount.length;l++)if(e<=a.endCount[l]){o=l;break}return o==-1||a.startCount[o]>e?0:65535&(a.idRangeOffset[o]!=0?a.glyphIdArray[e-a.startCount[o]+(a.idRangeOffset[o]>>1)-(a.idRangeOffset.length-o)]:e+a.idDelta[o])}if(a.format==12){if(e>a.groups[a.groups.length-1][1])return 0;for(l=0;l<a.groups.length;l++){var c=a.groups[l];if(c[0]<=e&&e<=c[1])return c[2]+(e-c[0])}return 0}throw"unknown cmap table format "+a.format},t.U.glyphToPath=function(r,e){var i={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var s=r.SVG.entries[e];return s==null?i:(typeof s=="string"&&(s=t.SVG.toPath(s),r.SVG.entries[e]=s),s)}if(r.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},o=r.CFF,l=r.CFF.Private;if(o.ROS){for(var c=0;o.FDSelect[c+2]<=e;)c+=2;l=o.FDArray[o.FDSelect[c+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],a,o,l,i)}else r.glyf&&t.U._drawGlyf(e,r,i);return i},t.U._drawGlyf=function(r,e,i){var s=e.glyf[r];s==null&&(s=e.glyf[r]=t.glyf._parseGlyf(e,r)),s!=null&&(s.noc>-1?t.U._simpleGlyph(s,i):t.U._compoGlyph(s,e,i))},t.U._simpleGlyph=function(r,e){for(var i=0;i<r.noc;i++){for(var s=i==0?0:r.endPts[i-1]+1,a=r.endPts[i],o=s;o<=a;o++){var l=o==s?a:o-1,c=o==a?s:o+1,h=1&r.flags[o],d=1&r.flags[l],v=1&r.flags[c],g=r.xs[o],m=r.ys[o];if(o==s)if(h){if(!d){t.U.P.moveTo(e,g,m);continue}t.U.P.moveTo(e,r.xs[l],r.ys[l])}else d?t.U.P.moveTo(e,r.xs[l],r.ys[l]):t.U.P.moveTo(e,(r.xs[l]+g)/2,(r.ys[l]+m)/2);h?d&&t.U.P.lineTo(e,g,m):v?t.U.P.qcurveTo(e,g,m,r.xs[c],r.ys[c]):t.U.P.qcurveTo(e,g,m,(g+r.xs[c])/2,(m+r.ys[c])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,i){for(var s=0;s<r.parts.length;s++){var a={cmds:[],crds:[]},o=r.parts[s];t.U._drawGlyf(o.glyphIndex,e,a);for(var l=o.m,c=0;c<a.crds.length;c+=2){var h=a.crds[c],d=a.crds[c+1];i.crds.push(h*l.a+d*l.b+l.tx),i.crds.push(h*l.c+d*l.d+l.ty)}for(c=0;c<a.cmds.length;c++)i.cmds.push(a.cmds[c])}},t.U._getGlyphClass=function(r,e){var i=t._lctf.getInterval(e,r);return i==-1?0:e[i+2]},t.U._applySubs=function(r,e,i,s){for(var a=r.length-e-1,o=0;o<i.tabs.length;o++)if(i.tabs[o]!=null){var l,c=i.tabs[o];if(!c.coverage||(l=t._lctf.coverageIndex(c.coverage,r[e]))!=-1){if(i.ltype==1)r[e],c.fmt==1?r[e]=r[e]+c.delta:r[e]=c.newg[l];else if(i.ltype==4)for(var h=c.vals[l],d=0;d<h.length;d++){var v=h[d],g=v.chain.length;if(!(g>a)){for(var m=!0,F=0,x=0;x<g;x++){for(;r[e+F+(1+x)]==-1;)F++;v.chain[x]!=r[e+F+(1+x)]&&(m=!1)}if(m){for(r[e]=v.nglyph,x=0;x<g+F;x++)r[e+x+1]=-1;break}}}else if(i.ltype==5&&c.fmt==2)for(var S=t._lctf.getInterval(c.cDef,r[e]),b=c.cDef[S+2],U=c.scset[b],P=0;P<U.length;P++){var _=U[P],w=_.input;if(!(w.length>a)){for(m=!0,x=0;x<w.length;x++){var O=t._lctf.getInterval(c.cDef,r[e+1+x]);if(S==-1&&c.cDef[O+2]!=w[x]){m=!1;break}}if(m){var C=_.substLookupRecords;for(d=0;d<C.length;d+=2)C[d],C[d+1]}}}else if(i.ltype==6&&c.fmt==3){if(!t.U._glsCovered(r,c.backCvg,e-c.backCvg.length)||!t.U._glsCovered(r,c.inptCvg,e)||!t.U._glsCovered(r,c.ahedCvg,e+c.inptCvg.length))continue;var X=c.lookupRec;for(P=0;P<X.length;P+=2){S=X[P];var y=s[X[P+1]];t.U._applySubs(r,e+S,y,s)}}}}},t.U._glsCovered=function(r,e,i){for(var s=0;s<e.length;s++)if(t._lctf.coverageIndex(e[s],r[i+s])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,i){for(var s={cmds:[],crds:[]},a=0,o=0;o<e.length;o++){var l=e[o];if(l!=-1){for(var c=o<e.length-1&&e[o+1]!=-1?e[o+1]:0,h=t.U.glyphToPath(r,l),d=0;d<h.crds.length;d+=2)s.crds.push(h.crds[d]+a),s.crds.push(h.crds[d+1]);for(i&&s.cmds.push(i),d=0;d<h.cmds.length;d++)s.cmds.push(h.cmds[d]);i&&s.cmds.push("X"),a+=r.hmtx.aWidth[l],o<e.length-1&&(a+=t.U.getPairAdjustment(r,l,c))}}return s},t.U.P={},t.U.P.moveTo=function(r,e,i){r.cmds.push("M"),r.crds.push(e,i)},t.U.P.lineTo=function(r,e,i){r.cmds.push("L"),r.crds.push(e,i)},t.U.P.curveTo=function(r,e,i,s,a,o,l){r.cmds.push("C"),r.crds.push(e,i,s,a,o,l)},t.U.P.qcurveTo=function(r,e,i,s,a){r.cmds.push("Q"),r.crds.push(e,i,s,a)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,i,s,a){for(var o=e.stack,l=e.nStems,c=e.haveWidth,h=e.width,d=e.open,v=0,g=e.x,m=e.y,F=0,x=0,S=0,b=0,U=0,P=0,_=0,w=0,O=0,C=0,X={val:0,size:0};v<r.length;){t.CFF.getCharString(r,v,X);var y=X.val;if(v+=X.size,y=="o1"||y=="o18")o.length%2!=0&&!c&&(h=o.shift()+s.nominalWidthX),l+=o.length>>1,o.length=0,c=!0;else if(y=="o3"||y=="o23")o.length%2!=0&&!c&&(h=o.shift()+s.nominalWidthX),l+=o.length>>1,o.length=0,c=!0;else if(y=="o4")o.length>1&&!c&&(h=o.shift()+s.nominalWidthX,c=!0),d&&t.U.P.closePath(a),m+=o.pop(),t.U.P.moveTo(a,g,m),d=!0;else if(y=="o5")for(;o.length>0;)g+=o.shift(),m+=o.shift(),t.U.P.lineTo(a,g,m);else if(y=="o6"||y=="o7")for(var R=o.length,M=y=="o6",W=0;W<R;W++){var H=o.shift();M?g+=H:m+=H,M=!M,t.U.P.lineTo(a,g,m)}else if(y=="o8"||y=="o24"){R=o.length;for(var Q=0;Q+6<=R;)F=g+o.shift(),x=m+o.shift(),S=F+o.shift(),b=x+o.shift(),g=S+o.shift(),m=b+o.shift(),t.U.P.curveTo(a,F,x,S,b,g,m),Q+=6;y=="o24"&&(g+=o.shift(),m+=o.shift(),t.U.P.lineTo(a,g,m))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(x=m,S=(F=g+o.shift())+o.shift(),C=b=x+o.shift(),P=b,w=m,g=(_=(U=(O=S+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(a,F,x,S,b,O,C),t.U.P.curveTo(a,U,P,_,w,g,m)),y=="o1235"&&(F=g+o.shift(),x=m+o.shift(),S=F+o.shift(),b=x+o.shift(),O=S+o.shift(),C=b+o.shift(),U=O+o.shift(),P=C+o.shift(),_=U+o.shift(),w=P+o.shift(),g=_+o.shift(),m=w+o.shift(),o.shift(),t.U.P.curveTo(a,F,x,S,b,O,C),t.U.P.curveTo(a,U,P,_,w,g,m)),y=="o1236"&&(F=g+o.shift(),x=m+o.shift(),S=F+o.shift(),C=b=x+o.shift(),P=b,_=(U=(O=S+o.shift())+o.shift())+o.shift(),w=P+o.shift(),g=_+o.shift(),t.U.P.curveTo(a,F,x,S,b,O,C),t.U.P.curveTo(a,U,P,_,w,g,m)),y=="o1237"&&(F=g+o.shift(),x=m+o.shift(),S=F+o.shift(),b=x+o.shift(),O=S+o.shift(),C=b+o.shift(),U=O+o.shift(),P=C+o.shift(),_=U+o.shift(),w=P+o.shift(),Math.abs(_-g)>Math.abs(w-m)?g=_+o.shift():m=w+o.shift(),t.U.P.curveTo(a,F,x,S,b,O,C),t.U.P.curveTo(a,U,P,_,w,g,m));else if(y=="o14"){if(o.length>0&&!c&&(h=o.shift()+i.nominalWidthX,c=!0),o.length==4){var re=o.shift(),G=o.shift(),k=o.shift(),p=o.shift(),T=t.CFF.glyphBySE(i,k),D=t.CFF.glyphBySE(i,p);t.U._drawCFF(i.CharStrings[T],e,i,s,a),e.x=re,e.y=G,t.U._drawCFF(i.CharStrings[D],e,i,s,a)}d&&(t.U.P.closePath(a),d=!1)}else if(y=="o19"||y=="o20")o.length%2!=0&&!c&&(h=o.shift()+s.nominalWidthX),l+=o.length>>1,o.length=0,c=!0,v+=l+7>>3;else if(y=="o21")o.length>2&&!c&&(h=o.shift()+s.nominalWidthX,c=!0),m+=o.pop(),g+=o.pop(),d&&t.U.P.closePath(a),t.U.P.moveTo(a,g,m),d=!0;else if(y=="o22")o.length>1&&!c&&(h=o.shift()+s.nominalWidthX,c=!0),g+=o.pop(),d&&t.U.P.closePath(a),t.U.P.moveTo(a,g,m),d=!0;else if(y=="o25"){for(;o.length>6;)g+=o.shift(),m+=o.shift(),t.U.P.lineTo(a,g,m);F=g+o.shift(),x=m+o.shift(),S=F+o.shift(),b=x+o.shift(),g=S+o.shift(),m=b+o.shift(),t.U.P.curveTo(a,F,x,S,b,g,m)}else if(y=="o26")for(o.length%2&&(g+=o.shift());o.length>0;)F=g,x=m+o.shift(),g=S=F+o.shift(),m=(b=x+o.shift())+o.shift(),t.U.P.curveTo(a,F,x,S,b,g,m);else if(y=="o27")for(o.length%2&&(m+=o.shift());o.length>0;)x=m,S=(F=g+o.shift())+o.shift(),b=x+o.shift(),g=S+o.shift(),m=b,t.U.P.curveTo(a,F,x,S,b,g,m);else if(y=="o10"||y=="o29"){var A=y=="o10"?s:i;if(o.length==0)console.debug("error: empty stack");else{var E=o.pop(),z=A.Subrs[E+A.Bias];e.x=g,e.y=m,e.nStems=l,e.haveWidth=c,e.width=h,e.open=d,t.U._drawCFF(z,e,i,s,a),g=e.x,m=e.y,l=e.nStems,c=e.haveWidth,h=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var B=o.length,L=(Q=0,y=="o31");for(Q+=B-(R=-3&B);Q<R;)L?(x=m,S=(F=g+o.shift())+o.shift(),m=(b=x+o.shift())+o.shift(),R-Q==5?(g=S+o.shift(),Q++):g=S,L=!1):(F=g,x=m+o.shift(),S=F+o.shift(),b=x+o.shift(),g=S+o.shift(),R-Q==5?(m=b+o.shift(),Q++):m=b,L=!0),t.U.P.curveTo(a,F,x,S,b,g,m),Q+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,r),y;o.push(y)}}}e.x=g,e.y=m,e.nStems=l,e.haveWidth=c,e.width=h,e.open=d};var u=t,f={Typr:u};return n.Typr=u,n.default=f,Object.defineProperty(n,"__esModule",{value:!0}),n}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function ga(){return function(n){var t=Uint8Array,u=Uint16Array,f=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(y,R){for(var M=new u(31),W=0;W<31;++W)M[W]=R+=1<<y[W-1];var H=new f(M[30]);for(W=1;W<30;++W)for(var Q=M[W];Q<M[W+1];++Q)H[Q]=Q-M[W]<<5|W;return[M,H]},a=s(r,2),o=a[0],l=a[1];o[28]=258,l[258]=28;for(var c=s(e,0)[0],h=new u(32768),d=0;d<32768;++d){var v=(43690&d)>>>1|(21845&d)<<1;v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4,h[d]=((65280&v)>>>8|(255&v)<<8)>>>1}var g=function(y,R,M){for(var W=y.length,H=0,Q=new u(R);H<W;++H)++Q[y[H]-1];var re,G=new u(R);for(H=0;H<R;++H)G[H]=G[H-1]+Q[H-1]<<1;{re=new u(1<<R);var k=15-R;for(H=0;H<W;++H)if(y[H])for(var p=H<<4|y[H],T=R-y[H],D=G[y[H]-1]++<<T,A=D|(1<<T)-1;D<=A;++D)re[h[D]>>>k]=p}return re},m=new t(288);for(d=0;d<144;++d)m[d]=8;for(d=144;d<256;++d)m[d]=9;for(d=256;d<280;++d)m[d]=7;for(d=280;d<288;++d)m[d]=8;var F=new t(32);for(d=0;d<32;++d)F[d]=5;var x=g(m,9),S=g(F,5),b=function(y){for(var R=y[0],M=1;M<y.length;++M)y[M]>R&&(R=y[M]);return R},U=function(y,R,M){var W=R/8|0;return(y[W]|y[W+1]<<8)>>(7&R)&M},P=function(y,R){var M=R/8|0;return(y[M]|y[M+1]<<8|y[M+2]<<16)>>(7&R)},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(y,R,M){var W=new Error(R||_[y]);if(W.code=y,Error.captureStackTrace&&Error.captureStackTrace(W,w),!M)throw W;return W},O=function(y,R,M){var W=y.length;if(!W||M&&!M.l&&W<5)return R||new t(0);var H=!R||M,Q=!M||M.i;M||(M={}),R||(R=new t(3*W));var re,G=function(le){var Be=R.length;if(le>Be){var Ae=new t(Math.max(2*Be,le));Ae.set(R),R=Ae}},k=M.f||0,p=M.p||0,T=M.b||0,D=M.l,A=M.d,E=M.m,z=M.n,B=8*W;do{if(!D){M.f=k=U(y,p,1);var L=U(y,p+1,3);if(p+=3,!L){var Y=y[(q=((re=p)/8|0)+(7&re&&1)+4)-4]|y[q-3]<<8,$=q+Y;if($>W){Q&&w(0);break}H&&G(T+Y),R.set(y.subarray(q,$),T),M.b=T+=Y,M.p=p=8*$;continue}if(L==1)D=x,A=S,E=9,z=5;else if(L==2){var V=U(y,p,31)+257,N=U(y,p+10,15)+4,ge=V+U(y,p+5,31)+1;p+=14;for(var fe=new t(ge),J=new t(19),ee=0;ee<N;++ee)J[i[ee]]=U(y,p+3*ee,7);p+=3*N;var oe=b(J),j=(1<<oe)-1,te=g(J,oe);for(ee=0;ee<ge;){var q,I=te[U(y,p,j)];if(p+=15&I,(q=I>>>4)<16)fe[ee++]=q;else{var de=0,Z=0;for(q==16?(Z=3+U(y,p,3),p+=2,de=fe[ee-1]):q==17?(Z=3+U(y,p,7),p+=3):q==18&&(Z=11+U(y,p,127),p+=7);Z--;)fe[ee++]=de}}var ie=fe.subarray(0,V),K=fe.subarray(V);E=b(ie),z=b(K),D=g(ie,E),A=g(K,z)}else w(1);if(p>B){Q&&w(0);break}}H&&G(T+131072);for(var we=(1<<E)-1,ne=(1<<z)-1,ae=p;;ae=p){var ue=(de=D[P(y,p)&we])>>>4;if((p+=15&de)>B){Q&&w(0);break}if(de||w(2),ue<256)R[T++]=ue;else{if(ue==256){ae=p,D=null;break}var ve=ue-254;if(ue>264){var Me=r[ee=ue-257];ve=U(y,p,(1<<Me)-1)+o[ee],p+=Me}var Fe=A[P(y,p)&ne],me=Fe>>>4;if(Fe||w(3),p+=15&Fe,K=c[me],me>3&&(Me=e[me],K+=P(y,p)&(1<<Me)-1,p+=Me),p>B){Q&&w(0);break}H&&G(T+131072);for(var ye=T+ve;T<ye;T+=4)R[T]=R[T-K],R[T+1]=R[T+1-K],R[T+2]=R[T+2-K],R[T+3]=R[T+3-K];T=ye}}M.l=D,M.p=ae,M.b=T,D&&(k=1,M.m=E,M.d=A,M.n=z)}while(!k);return T==R.length?R:function(le,Be,Ae){(Ae==null||Ae>le.length)&&(Ae=le.length);var We=new(le instanceof u?u:le instanceof f?f:t)(Ae-Be);return We.set(le.subarray(Be,Ae)),We}(R,0,T)},C=new t(0),X=typeof TextDecoder<"u"&&new TextDecoder;try{X.decode(C,{stream:!0})}catch{}return n.convert_streams=function(y){var R=new DataView(y),M=0;function W(){var V=R.getUint16(M);return M+=2,V}function H(){var V=R.getUint32(M);return M+=4,V}function Q(V){Y.setUint16($,V),$+=2}function re(V){Y.setUint32($,V),$+=4}for(var G={signature:H(),flavor:H(),length:H(),numTables:W(),reserved:W(),totalSfntSize:H(),majorVersion:W(),minorVersion:W(),metaOffset:H(),metaLength:H(),metaOrigLength:H(),privOffset:H(),privLength:H()},k=0;Math.pow(2,k)<=G.numTables;)k++;k--;for(var p=16*Math.pow(2,k),T=16*G.numTables-p,D=12,A=[],E=0;E<G.numTables;E++)A.push({tag:H(),offset:H(),compLength:H(),origLength:H(),origChecksum:H()}),D+=16;var z,B=new Uint8Array(12+16*A.length+A.reduce(function(V,N){return V+N.origLength+4},0)),L=B.buffer,Y=new DataView(L),$=0;return re(G.flavor),Q(G.numTables),Q(p),Q(k),Q(T),A.forEach(function(V){re(V.tag),re(V.origChecksum),re(D),re(V.origLength),V.outOffset=D,(D+=V.origLength)%4!=0&&(D+=4-D%4)}),A.forEach(function(V){var N,ge=y.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var fe=new Uint8Array(V.origLength);N=new Uint8Array(ge,2),O(N,fe)}else fe=new Uint8Array(ge);B.set(fe,V.outOffset);var J=0;(D=V.outOffset+V.origLength)%4!=0&&(J=4-D%4),B.set(new Uint8Array(J).buffer,V.outOffset+V.origLength),z=D+J}),L.slice(0,z)},Object.defineProperty(n,"__esModule",{value:!0}),n}({}).convert_streams}function ma(n,t){const u={M:2,L:2,Q:4,C:6,Z:0},f={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,i=4,s=8,a=16,o=32;let l;function c(_){if(!l){const w={R:e,L:r,D:i,C:a,U:o,T:s};l=new Map;for(let O in f){let C=0;f[O].split(",").forEach(X=>{let[y,R]=X.split("+");y=parseInt(y,36),R=R?parseInt(R,36):0,l.set(C+=y,w[O]);for(let M=R;M--;)l.set(++C,w[O])})}}return l.get(_)||o}const h=1,d=2,v=3,g=4,m=[null,"isol","init","fina","medi"];function F(_){const w=new Uint8Array(_.length);let O=o,C=h,X=-1;for(let y=0;y<_.length;y++){const R=_.codePointAt(y);let M=c(R)|0,W=h;M&s||(O&(r|i|a)?M&(e|i|a)?(W=v,(C===h||C===v)&&w[X]++):M&(r|o)&&(C===d||C===g)&&w[X]--:O&(e|o)&&(C===d||C===g)&&w[X]--,C=w[y]=W,O=M,X=y,R>65535&&y++)}return w}function x(_,w){const O=[];for(let X=0;X<w.length;X++){const y=w.codePointAt(X);y>65535&&X++,O.push(n.U.codeToGlyph(_,y))}const C=_.GSUB;if(C){const{lookupList:X,featureList:y}=C;let R;const M=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,W=[];y.forEach(H=>{if(M.test(H.tag))for(let Q=0;Q<H.tab.length;Q++){if(W[H.tab[Q]])continue;W[H.tab[Q]]=!0;const re=X[H.tab[Q]],G=/^(isol|init|fina|medi)$/.test(H.tag);G&&!R&&(R=F(w));for(let k=0;k<O.length;k++)(!R||!G||m[R[k]]===H.tag)&&n.U._applySubs(O,k,re,X)}})}return O}function S(_,w){const O=new Int16Array(w.length*3);let C=0;for(;C<w.length;C++){const M=w[C];if(M===-1)continue;O[C*3+2]=_.hmtx.aWidth[M];const W=_.GPOS;if(W){const H=W.lookupList;for(let Q=0;Q<H.length;Q++){const re=H[Q];for(let G=0;G<re.tabs.length;G++){const k=re.tabs[G];if(re.ltype===1){if(n._lctf.coverageIndex(k.coverage,M)!==-1&&k.pos){R(k.pos,C);break}}else if(re.ltype===2){let p=null,T=X();if(T!==-1){const D=n._lctf.coverageIndex(k.coverage,w[T]);if(D!==-1){if(k.fmt===1){const A=k.pairsets[D];for(let E=0;E<A.length;E++)A[E].gid2===M&&(p=A[E])}else if(k.fmt===2){const A=n.U._getGlyphClass(w[T],k.classDef1),E=n.U._getGlyphClass(M,k.classDef2);p=k.matrix[A][E]}if(p){p.val1&&R(p.val1,T),p.val2&&R(p.val2,C);break}}}}else if(re.ltype===4){const p=n._lctf.coverageIndex(k.markCoverage,M);if(p!==-1){const T=X(y),D=T===-1?-1:n._lctf.coverageIndex(k.baseCoverage,w[T]);if(D!==-1){const A=k.markArray[p],E=k.baseArray[D][A.markClass];O[C*3]=E.x-A.x+O[T*3]-O[T*3+2],O[C*3+1]=E.y-A.y+O[T*3+1];break}}}else if(re.ltype===6){const p=n._lctf.coverageIndex(k.mark1Coverage,M);if(p!==-1){const T=X();if(T!==-1){const D=w[T];if(b(_,D)===3){const A=n._lctf.coverageIndex(k.mark2Coverage,D);if(A!==-1){const E=k.mark1Array[p],z=k.mark2Array[A][E.markClass];O[C*3]=z.x-E.x+O[T*3]-O[T*3+2],O[C*3+1]=z.y-E.y+O[T*3+1];break}}}}}}}}else if(_.kern&&!_.cff){const H=X();if(H!==-1){const Q=_.kern.glyph1.indexOf(w[H]);if(Q!==-1){const re=_.kern.rval[Q].glyph2.indexOf(M);re!==-1&&(O[H*3+2]+=_.kern.rval[Q].vals[re])}}}}return O;function X(M){for(let W=C-1;W>=0;W--)if(w[W]!==-1&&(!M||M(w[W])))return W;return-1}function y(M){return b(_,M)===1}function R(M,W){for(let H=0;H<3;H++)O[W*3+H]+=M[H]||0}}function b(_,w){const O=_.GDEF&&_.GDEF.glyphClassDef;return O?n.U._getGlyphClass(w,O):0}function U(..._){for(let w=0;w<_.length;w++)if(typeof _[w]=="number")return _[w]}function P(_){const w=Object.create(null),O=_["OS/2"],C=_.hhea,X=_.head.unitsPerEm,y=U(O&&O.sTypoAscender,C&&C.ascender,X),R={unitsPerEm:X,ascender:y,descender:U(O&&O.sTypoDescender,C&&C.descender,0),capHeight:U(O&&O.sCapHeight,y),xHeight:U(O&&O.sxHeight,y),lineGap:U(O&&O.sTypoLineGap,C&&C.lineGap),supportsCodePoint(M){return n.U.codeToGlyph(_,M)>0},forEachGlyph(M,W,H,Q){let re=0;const G=1/R.unitsPerEm*W,k=x(_,M);let p=0;const T=S(_,k);return k.forEach((D,A)=>{if(D!==-1){let E=w[D];if(!E){const{cmds:z,crds:B}=n.U.glyphToPath(_,D);let L="",Y=0;for(let fe=0,J=z.length;fe<J;fe++){const ee=u[z[fe]];L+=z[fe];for(let oe=1;oe<=ee;oe++)L+=(oe>1?",":"")+B[Y++]}let $,V,N,ge;if(B.length){$=V=1/0,N=ge=-1/0;for(let fe=0,J=B.length;fe<J;fe+=2){let ee=B[fe],oe=B[fe+1];ee<$&&($=ee),oe<V&&(V=oe),ee>N&&(N=ee),oe>ge&&(ge=oe)}}else $=N=V=ge=0;E=w[D]={index:D,advanceWidth:_.hmtx.aWidth[D],xMin:$,yMin:V,xMax:N,yMax:ge,path:L}}Q.call(null,E,re+T[A*3]*G,T[A*3+1]*G,p),re+=T[A*3+2]*G,H&&(re+=H*W)}p+=M.codePointAt(p)>65535?2:1}),re}};return R}return function(w){const O=new Uint8Array(w,0,4),C=n._bin.readASCII(O,0,4);if(C==="wOFF")w=t(w);else if(C==="wOF2")throw new Error("woff2 fonts not supported");return P(n.parse(w)[0])}}const ya=_t({name:"Typr Font Parser",dependencies:[pa,ga,ma],init(n,t,u){const f=n(),r=t();return u(f,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function xa(){return function(n){var t=function(){this.buckets=new Map};t.prototype.add=function(S){var b=S>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&S))},t.prototype.has=function(S){var b=this.buckets.get(S>>5);return b!==void 0&&(b&1<<(31&S))!=0},t.prototype.serialize=function(){var S=[];return this.buckets.forEach(function(b,U){S.push((+U).toString(36)+":"+b.toString(36))}),S.join(",")},t.prototype.deserialize=function(S){var b=this;this.buckets.clear(),S.split(",").forEach(function(U){var P=U.split(":");b.buckets.set(parseInt(P[0],36),parseInt(P[1],36))})};var u=Math.pow(2,8),f=u-1,r=~f;function e(S){var b=function(P){return P&r}(S).toString(16),U=function(P){return(P&r)+u-1}(S).toString(16);return"codepoint-index/plane"+(S>>16)+"/"+b+"-"+U+".json"}function i(S,b){var U=S&f,P=b.codePointAt(U/6|0);return((P=(P||48)-48)&1<<U%6)!=0}function s(S,b){var U;(U=S,U.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(P){return P.split("-").map(function(_){return parseInt(_.trim(),16)})})).forEach(function(P){var _=P[0],w=P[1];w===void 0&&(w=_),b(_,w)})}function a(S,b){s(S,function(U,P){for(var _=U;_<=P;_++)b(_)})}var o={},l={},c=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(S){var b=c.get(S);return b||(b=new t,a(S.ranges,function(U){return b.add(U)}),c.set(S,b)),b}var v,g=new Map;function m(S,b,U){return S[b]?b:S[U]?U:function(P){for(var _ in P)return _}(S)}function F(S,b){var U=b;if(!S.includes(U)){U=1/0;for(var P=0;P<S.length;P++)Math.abs(S[P]-b)<Math.abs(U-b)&&(U=S[P])}return U}function x(S){return v||(v=new Set,a("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(b){v.add(b)})),v.has(S)}return n.CodePointSet=t,n.clearCache=function(){o={},l={}},n.getFontsForString=function(S,b){b===void 0&&(b={});var U,P=b.lang;P===void 0&&(P=new RegExp("\\p{Script=Hangul}","u").test(U=S)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(U)?"ja":"en");var _=b.category;_===void 0&&(_="sans-serif");var w=b.style;w===void 0&&(w="normal");var O=b.weight;O===void 0&&(O=400);var C=(b.dataUrl||h).replace(/\/$/g,""),X=new Map,y=new Uint8Array(S.length),R={},M={},W=new Array(S.length),H=new Map,Q=!1;function re(p){var T=g.get(p);return T||(T=fetch(C+"/"+p).then(function(D){if(!D.ok)throw new Error(D.statusText);return D.json().then(function(A){if(!Array.isArray(A)||A[0]!==1)throw new Error("Incorrect schema version; need 1, got "+A[0]);return A[1]})}).catch(function(D){if(C!==h)return Q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+C+'", trying default CDN. '+D.message),Q=!0),C=h,g.delete(p),re(p);throw D}),g.set(p,T)),T}for(var G=function(p){var T=S.codePointAt(p),D=e(T);W[p]=D,o[D]||H.has(D)||H.set(D,re(D).then(function(A){o[D]=A})),T>65535&&(p++,k=p)},k=0;k<S.length;k++)G(k);return Promise.all(H.values()).then(function(){H.clear();for(var p=function(D){var A=S.codePointAt(D),E=null,z=o[W[D]],B=void 0;for(var L in z){var Y=M[L];if(Y===void 0&&(Y=M[L]=new RegExp(L).test(P||"en")),Y){for(var $ in B=L,z[L])if(i(A,z[L][$])){E=$;break}break}}if(!E){e:for(var V in z)if(V!==B){for(var N in z[V])if(i(A,z[V][N])){E=N;break e}}}E||(console.debug("No font coverage for U+"+A.toString(16)),E="latin"),W[D]=E,l[E]||H.has(E)||H.set(E,re("font-meta/"+E+".json").then(function(ge){l[E]=ge})),A>65535&&(D++,T=D)},T=0;T<S.length;T++)p(T);return Promise.all(H.values())}).then(function(){for(var p,T=null,D=0;D<S.length;D++){var A=S.codePointAt(D);if(T&&(x(A)||d(T).has(A)))y[D]=y[D-1];else{T=l[W[D]];var E=R[T.id];if(!E){var z=T.typeforms,B=m(z,_,"sans-serif"),L=m(z[B],w,"normal"),Y=F((p=z[B])===null||p===void 0?void 0:p[L],O);E=R[T.id]=C+"/font-files/"+T.id+"/"+B+"."+L+"."+Y+".woff"}var $=X.get(E);$==null&&($=X.size,X.set(E,$)),y[D]=$}A>65535&&(D++,y[D]=y[D-1])}return{fontUrls:Array.from(X.keys()),chars:y}})},Object.defineProperty(n,"__esModule",{value:!0}),n}({})}function ba(n,t){const u=Object.create(null),f=Object.create(null);function r(i,s){const a=o=>{console.error(`Failure loading font ${i}`,o)};try{const o=new XMLHttpRequest;o.open("get",i,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status>=400)a(new Error(o.statusText));else if(o.status>0)try{const l=n(o.response);l.src=i,s(l)}catch(l){a(l)}},o.onerror=a,o.send()}catch(o){a(o)}}function e(i,s){let a=u[i];a?s(a):f[i]?f[i].push(s):(f[i]=[s],r(i,o=>{o.src=i,u[i]=o,f[i].forEach(l=>l(o)),delete f[i]}))}return function(i,s,{lang:a,fonts:o=[],style:l="normal",weight:c="normal",unicodeFontsURL:h}={}){const d=new Uint8Array(i.length),v=[];i.length||x();const g=new Map,m=[];if(l!=="italic"&&(l="normal"),typeof c!="number"&&(c=c==="bold"?700:400),o&&!Array.isArray(o)&&(o=[o]),o=o.slice().filter(b=>!b.lang||b.lang.test(a)).reverse(),o.length){let _=0;(function w(O=0){for(let C=O,X=i.length;C<X;C++){const y=i.codePointAt(C);if(_===1&&v[d[C-1]].supportsCodePoint(y)||C>0&&/\s/.test(i[C]))d[C]=d[C-1],_===2&&(m[m.length-1][1]=C);else for(let R=d[C],M=o.length;R<=M;R++)if(R===M){const W=_===2?m[m.length-1]:m[m.length]=[C,C];W[1]=C,_=2}else{d[C]=R;const{src:W,unicodeRange:H}=o[R];if(!H||S(y,H)){const Q=u[W];if(!Q){e(W,()=>{w(C)});return}if(Q.supportsCodePoint(y)){let re=g.get(Q);typeof re!="number"&&(re=v.length,v.push(Q),g.set(Q,re)),d[C]=re,_=1;break}}}y>65535&&C+1<X&&(d[C+1]=d[C],C++,_===2&&(m[m.length-1][1]=C))}F()})()}else m.push([0,i.length-1]),F();function F(){if(m.length){const b=m.map(U=>i.substring(U[0],U[1]+1)).join(`
`);t.getFontsForString(b,{lang:a||void 0,style:l,weight:c,dataUrl:h}).then(({fontUrls:U,chars:P})=>{const _=v.length;let w=0;m.forEach(C=>{for(let X=0,y=C[1]-C[0];X<=y;X++)d[C[0]+X]=P[w++]+_;w++});let O=0;U.forEach((C,X)=>{e(C,y=>{v[X+_]=y,++O===U.length&&x()})})})}else x()}function x(){s({chars:d,fonts:v})}function S(b,U){for(let P=0;P<U.length;P++){const[_,w=_]=U[P];if(_<=b&&b<=w)return!0}return!1}}}const Sa=_t({name:"FontResolver",dependencies:[ba,ya,xa],init(n,t,u){return n(t,u())}});function Ta(n,t){const f=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",e=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function i({text:v,lang:g,fonts:m,style:F,weight:x,preResolvedFonts:S,unicodeFontsURL:b},U){const P=({chars:_,fonts:w})=>{let O,C;const X=[];for(let y=0;y<_.length;y++)_[y]!==C?(C=_[y],X.push(O={start:y,end:y,fontObj:w[_[y]]})):O.end=y;U(X)};S?P(S):n(v,P,{lang:g,fonts:m,style:F,weight:x,unicodeFontsURL:b})}function s({text:v="",font:g,lang:m,sdfGlyphSize:F=64,fontSize:x=400,fontWeight:S=1,fontStyle:b="normal",letterSpacing:U=0,lineHeight:P="normal",maxWidth:_=1/0,direction:w,textAlign:O="left",textIndent:C=0,whiteSpace:X="normal",overflowWrap:y="normal",anchorX:R=0,anchorY:M=0,metricsOnly:W=!1,unicodeFontsURL:H,preResolvedFonts:Q=null,includeCaretPositions:re=!1,chunkedBoundsSize:G=8192,colorRanges:k=null},p){const T=c(),D={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),x=+x,U=+U,_=+_,P=P||"normal",C=+C,i({text:v,lang:m,style:b,weight:S,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:H,preResolvedFonts:Q},A=>{D.fontLoad=c()-T;const E=isFinite(_);let z=null,B=null,L=null,Y=null,$=null,V=null,N=null,ge=null,fe=0,J=0,ee=X!=="nowrap";const oe=new Map,j=c();let te=C,q=0,I=new h;const de=[I];A.forEach(ne=>{const{fontObj:ae}=ne,{ascender:ue,descender:ve,unitsPerEm:Me,lineGap:Fe,capHeight:me,xHeight:ye}=ae;let le=oe.get(ae);if(!le){const ce=x/Me,_e=P==="normal"?(ue-ve+Fe)*ce:P*x,nt=(_e-(ue-ve)*ce)/2,Ee=Math.min(_e,(ue-ve)*ce),xe=(ue+ve)/2*ce+Ee/2;le={index:oe.size,src:ae.src,fontObj:ae,fontSizeMult:ce,unitsPerEm:Me,ascender:ue*ce,descender:ve*ce,capHeight:me*ce,xHeight:ye*ce,lineHeight:_e,baseline:-nt-ue*ce,caretTop:xe,caretBottom:xe-Ee},oe.set(ae,le)}const{fontSizeMult:Be}=le,Ae=v.slice(ne.start,ne.end+1);let We,De;ae.forEachGlyph(Ae,x,U,(ce,_e,nt,Ee)=>{_e+=q,Ee+=ne.start,We=_e,De=ce;const xe=v.charAt(Ee),Pe=ce.advanceWidth*Be,Ce=I.count;let pe;if("isEmpty"in ce||(ce.isWhitespace=!!xe&&new RegExp(r).test(xe),ce.canBreakAfter=!!xe&&e.test(xe),ce.isEmpty=ce.xMin===ce.xMax||ce.yMin===ce.yMax||f.test(xe)),!ce.isWhitespace&&!ce.isEmpty&&J++,ee&&E&&!ce.isWhitespace&&_e+Pe+te>_&&Ce){if(I.glyphAt(Ce-1).glyphObj.canBreakAfter)pe=new h,te=-_e;else for(let Ne=Ce;Ne--;)if(Ne===0&&y==="break-word"){pe=new h,te=-_e;break}else if(I.glyphAt(Ne).glyphObj.canBreakAfter){pe=I.splitAt(Ne+1);const Ge=pe.glyphAt(0).x;te-=Ge;for(let Oe=pe.count;Oe--;)pe.glyphAt(Oe).x-=Ge;break}pe&&(I.isSoftWrapped=!0,I=pe,de.push(I),fe=_)}let Re=I.glyphAt(I.count);Re.glyphObj=ce,Re.x=_e+te,Re.y=nt,Re.width=Pe,Re.charIndex=Ee,Re.fontData=le,xe===`
`&&(I=new h,de.push(I),te=-(_e+Pe+U*x)+C)}),q=We+De.advanceWidth*Be+U*x});let Z=0;de.forEach(ne=>{let ae=!0;for(let ue=ne.count;ue--;){const ve=ne.glyphAt(ue);ae&&!ve.glyphObj.isWhitespace&&(ne.width=ve.x+ve.width,ne.width>fe&&(fe=ne.width),ae=!1);let{lineHeight:Me,capHeight:Fe,xHeight:me,baseline:ye}=ve.fontData;Me>ne.lineHeight&&(ne.lineHeight=Me);const le=ye-ne.baseline;le<0&&(ne.baseline+=le,ne.cap+=le,ne.ex+=le),ne.cap=Math.max(ne.cap,ne.baseline+Fe),ne.ex=Math.max(ne.ex,ne.baseline+me)}ne.baseline-=Z,ne.cap-=Z,ne.ex-=Z,Z+=ne.lineHeight});let ie=0,K=0;if(R&&(typeof R=="number"?ie=-R:typeof R=="string"&&(ie=-fe*(R==="left"?0:R==="center"?.5:R==="right"?1:o(R)))),M&&(typeof M=="number"?K=-M:typeof M=="string"&&(K=M==="top"?0:M==="top-baseline"?-de[0].baseline:M==="top-cap"?-de[0].cap:M==="top-ex"?-de[0].ex:M==="middle"?Z/2:M==="bottom"?Z:M==="bottom-baseline"?-de[de.length-1].baseline:o(M)*Z)),!W){const ne=t.getEmbeddingLevels(v,w);z=new Uint16Array(J),B=new Uint8Array(J),L=new Float32Array(J*2),Y={},N=[1/0,1/0,-1/0,-1/0],ge=[],re&&(V=new Float32Array(v.length*4)),k&&($=new Uint8Array(J*3));let ae=0,ue=-1,ve=-1,Me,Fe;if(de.forEach((me,ye)=>{let{count:le,width:Be}=me;if(le>0){let Ae=0;for(let Ee=le;Ee--&&me.glyphAt(Ee).glyphObj.isWhitespace;)Ae++;let We=0,De=0;if(O==="center")We=(fe-Be)/2;else if(O==="right")We=fe-Be;else if(O==="justify"&&me.isSoftWrapped){let Ee=0;for(let xe=le-Ae;xe--;)me.glyphAt(xe).glyphObj.isWhitespace&&Ee++;De=(fe-Be)/Ee}if(De||We){let Ee=0;for(let xe=0;xe<le;xe++){let Pe=me.glyphAt(xe);const Ce=Pe.glyphObj;Pe.x+=We+Ee,De!==0&&Ce.isWhitespace&&xe<le-Ae&&(Ee+=De,Pe.width+=De)}}const ce=t.getReorderSegments(v,ne,me.glyphAt(0).charIndex,me.glyphAt(me.count-1).charIndex);for(let Ee=0;Ee<ce.length;Ee++){const[xe,Pe]=ce[Ee];let Ce=1/0,pe=-1/0;for(let Re=0;Re<le;Re++)if(me.glyphAt(Re).charIndex>=xe){let Ne=Re,Ge=Re;for(;Ge<le;Ge++){let Oe=me.glyphAt(Ge);if(Oe.charIndex>Pe)break;Ge<le-Ae&&(Ce=Math.min(Ce,Oe.x),pe=Math.max(pe,Oe.x+Oe.width))}for(let Oe=Ne;Oe<Ge;Oe++){const Ze=me.glyphAt(Oe);Ze.x=pe-(Ze.x+Ze.width-Ce)}break}}let _e;const nt=Ee=>_e=Ee;for(let Ee=0;Ee<le;Ee++){const xe=me.glyphAt(Ee);_e=xe.glyphObj;const Pe=_e.index,Ce=ne.levels[xe.charIndex]&1;if(Ce){const pe=t.getMirroredCharacter(v[xe.charIndex]);pe&&xe.fontData.fontObj.forEachGlyph(pe,0,0,nt)}if(re){const{charIndex:pe,fontData:Re}=xe,Ne=xe.x+ie,Ge=xe.x+xe.width+ie;V[pe*4]=Ce?Ge:Ne,V[pe*4+1]=Ce?Ne:Ge,V[pe*4+2]=me.baseline+Re.caretBottom+K,V[pe*4+3]=me.baseline+Re.caretTop+K;const Oe=pe-ue;Oe>1&&l(V,ue,Oe),ue=pe}if(k){const{charIndex:pe}=xe;for(;pe>ve;)ve++,k.hasOwnProperty(ve)&&(Fe=k[ve])}if(!_e.isWhitespace&&!_e.isEmpty){const pe=ae++,{fontSizeMult:Re,src:Ne,index:Ge}=xe.fontData,Oe=Y[Ne]||(Y[Ne]={});Oe[Pe]||(Oe[Pe]={path:_e.path,pathBounds:[_e.xMin,_e.yMin,_e.xMax,_e.yMax]});const Ze=xe.x+ie,it=xe.y+me.baseline+K;L[pe*2]=Ze,L[pe*2+1]=it;const et=Ze+_e.xMin*Re,at=it+_e.yMin*Re,ut=Ze+_e.xMax*Re,tt=it+_e.yMax*Re;et<N[0]&&(N[0]=et),at<N[1]&&(N[1]=at),ut>N[2]&&(N[2]=ut),tt>N[3]&&(N[3]=tt),pe%G===0&&(Me={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},ge.push(Me)),Me.end++;const He=Me.rect;if(et<He[0]&&(He[0]=et),at<He[1]&&(He[1]=at),ut>He[2]&&(He[2]=ut),tt>He[3]&&(He[3]=tt),z[pe]=Pe,B[pe]=Ge,k){const ft=pe*3;$[ft]=Fe>>16&255,$[ft+1]=Fe>>8&255,$[ft+2]=Fe&255}}}}}),V){const me=v.length-ue;me>1&&l(V,ue,me)}}const we=[];oe.forEach(({index:ne,src:ae,unitsPerEm:ue,ascender:ve,descender:Me,lineHeight:Fe,capHeight:me,xHeight:ye})=>{we[ne]={src:ae,unitsPerEm:ue,ascender:ve,descender:Me,lineHeight:Fe,capHeight:me,xHeight:ye}}),D.typesetting=c()-j,p({glyphIds:z,glyphFontIndices:B,glyphPositions:L,glyphData:Y,fontData:we,caretPositions:V,glyphColors:$,chunkedBounds:ge,fontSize:x,topBaseline:K+de[0].baseline,blockBounds:[ie,K-Z,ie+fe,K],visibleBounds:N,timings:D})})}function a(v,g){s({...v,metricsOnly:!0},m=>{const[F,x,S,b]=m.blockBounds;g({width:S-F,height:b-x})})}function o(v){let g=v.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function l(v,g,m){const F=v[g*4],x=v[g*4+1],S=v[g*4+2],b=v[g*4+3],U=(x-F)/m;for(let P=0;P<m;P++){const _=(g+P)*4;v[_]=F+U*P,v[_+1]=F+U*(P+1),v[_+2]=S,v[_+3]=b}}function c(){return(self.performance||Date).now()}function h(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(v){let g=h.flyweight;return g.data=this.data,g.index=v,g},splitAt(v){let g=new h;return g.data=this.data.splice(v*d.length),g}},h.flyweight=d.reduce((v,g,m,F)=>(Object.defineProperty(v,g,{get(){return this.data[this.index*d.length+m]},set(x){this.data[this.index*d.length+m]=x}}),v),{data:null,index:0}),{typeset:s,measure:a}}const ht=()=>(self.performance||Date).now(),dr=ni();let Cn;function wa(n,t,u,f,r,e,i,s,a,o,l=!0){return l?_a(n,t,u,f,r,e,i,s,a,o).then(null,c=>(Cn||(console.warn("WebGL SDF generation failed, falling back to JS",c),Cn=!0),Fn(n,t,u,f,r,e,i,s,a,o))):Fn(n,t,u,f,r,e,i,s,a,o)}const lr=[],Ua=5;let Wr=0;function ai(){const n=ht();for(;lr.length&&ht()-n<Ua;)lr.shift()();Wr=lr.length?setTimeout(ai,0):0}const _a=(...n)=>new Promise((t,u)=>{lr.push(()=>{const f=ht();try{dr.webgl.generateIntoCanvas(...n),t({timing:ht()-f})}catch(r){u(r)}}),Wr||(Wr=setTimeout(ai,0))}),Ea=4,Ma=2e3,Rn={};let Da=0;function Fn(n,t,u,f,r,e,i,s,a,o){const l="TroikaTextSDFGenerator_JS_"+Da++%Ea;let c=Rn[l];return c||(c=Rn[l]={workerModule:_t({name:l,workerId:l,dependencies:[ni,ht],init(h,d){const v=h().javascript.generate;return function(...g){const m=d();return{textureData:v(...g),timing:d()-m}}},getTransferables(h){return[h.textureData.buffer]}}),requests:0,idleTimer:null}),c.requests++,clearTimeout(c.idleTimer),c.workerModule(n,t,u,f,r,e).then(({textureData:h,timing:d})=>{const v=ht(),g=new Uint8Array(h.length*4);for(let m=0;m<h.length;m++)g[m*4+o]=h[m];return dr.webglUtils.renderImageData(i,g,s,a,n,t,1<<3-o),d+=ht()-v,--c.requests===0&&(c.idleTimer=setTimeout(()=>{aa(l)},Ma)),{timing:d}})}function Aa(n){n._warm||(dr.webgl.isSupported(n),n._warm=!0)}const Ca=dr.webglUtils.resizeWebGLCanvasWithoutClearing,Gt={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Ra=new pt;function St(){return(self.performance||Date).now()}const Bn=Object.create(null);function si(n,t){n=ka({},n);const u=St(),f=[];if(n.font&&f.push({label:"user",src:Pa(n.font)}),n.font=f,n.text=""+n.text,n.sdfGlyphSize=n.sdfGlyphSize||Gt.sdfGlyphSize,n.unicodeFontsURL=n.unicodeFontsURL||Gt.unicodeFontsURL,n.colorRanges!=null){let h={};for(let d in n.colorRanges)if(n.colorRanges.hasOwnProperty(d)){let v=n.colorRanges[d];typeof v!="number"&&(v=Ra.set(v).getHex()),h[d]=v}n.colorRanges=h}Object.freeze(n);const{textureWidth:r,sdfExponent:e}=Gt,{sdfGlyphSize:i}=n,s=r/i*4;let a=Bn[i];if(!a){const h=document.createElement("canvas");h.width=r,h.height=i*256/s,a=Bn[i]={glyphCount:0,sdfGlyphSize:i,sdfCanvas:h,sdfTexture:new Ht(h,void 0,void 0,void 0,wt,wt),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,Fa(a)}const{sdfTexture:o,sdfCanvas:l}=a;ui(n).then(h=>{const{glyphIds:d,glyphFontIndices:v,fontData:g,glyphPositions:m,fontSize:F,timings:x}=h,S=[],b=new Float32Array(d.length*4);let U=0,P=0;const _=St(),w=g.map(R=>{let M=a.glyphsByFont.get(R.src);return M||a.glyphsByFont.set(R.src,M=new Map),M});d.forEach((R,M)=>{const W=v[M],{src:H,unitsPerEm:Q}=g[W];let re=w[W].get(R);if(!re){const{path:D,pathBounds:A}=h.glyphData[H][R],E=Math.max(A[2]-A[0],A[3]-A[1])/i*(Gt.sdfMargin*i+.5),z=a.glyphCount++,B=[A[0]-E,A[1]-E,A[2]+E,A[3]+E];w[W].set(R,re={path:D,atlasIndex:z,sdfViewBox:B}),S.push(re)}const{sdfViewBox:G}=re,k=m[P++],p=m[P++],T=F/Q;b[U++]=k+G[0]*T,b[U++]=p+G[1]*T,b[U++]=k+G[2]*T,b[U++]=p+G[3]*T,d[M]=re.atlasIndex}),x.quads=(x.quads||0)+(St()-_);const O=St();x.sdf={};const C=l.height,X=Math.ceil(a.glyphCount/s),y=Math.pow(2,Math.ceil(Math.log2(X*i)));y>C&&(console.info(`Increasing SDF texture size ${C}->${y}`),Ca(l,r,y),o.dispose()),Promise.all(S.map(R=>oi(R,a,n.gpuAccelerateSDF).then(({timing:M})=>{x.sdf[R.atlasIndex]=M}))).then(()=>{S.length&&!a.contextLost&&(li(a),o.needsUpdate=!0),x.sdfTotal=St()-O,x.total=St()-u,t(Object.freeze({parameters:n,sdfTexture:o,sdfGlyphSize:i,sdfExponent:e,glyphBounds:b,glyphAtlasIndices:d,glyphColors:h.glyphColors,caretPositions:h.caretPositions,chunkedBounds:h.chunkedBounds,ascender:h.ascender,descender:h.descender,lineHeight:h.lineHeight,capHeight:h.capHeight,xHeight:h.xHeight,topBaseline:h.topBaseline,blockBounds:h.blockBounds,visibleBounds:h.visibleBounds,timings:h.timings}))})}),Promise.resolve().then(()=>{a.contextLost||Aa(l)})}function oi({path:n,atlasIndex:t,sdfViewBox:u},{sdfGlyphSize:f,sdfCanvas:r,contextLost:e},i){if(e)return Promise.resolve({timing:-1});const{textureWidth:s,sdfExponent:a}=Gt,o=Math.max(u[2]-u[0],u[3]-u[1]),l=Math.floor(t/4),c=l%(s/f)*f,h=Math.floor(l/(s/f))*f,d=t%4;return wa(f,f,n,u,o,a,r,c,h,d,i)}function Fa(n){const t=n.sdfCanvas;t.addEventListener("webglcontextlost",u=>{console.log("Context Lost",u),u.preventDefault(),n.contextLost=!0}),t.addEventListener("webglcontextrestored",u=>{console.log("Context Restored",u),n.contextLost=!1;const f=[];n.glyphsByFont.forEach(r=>{r.forEach(e=>{f.push(oi(e,n,!0))})}),Promise.all(f).then(()=>{li(n),n.sdfTexture.needsUpdate=!0})})}function Ba({font:n,characters:t,sdfGlyphSize:u},f){let r=Array.isArray(t)?t.join(`
`):""+t;si({font:n,sdfGlyphSize:u,text:r},f)}function ka(n,t){for(let u in t)t.hasOwnProperty(u)&&(n[u]=t[u]);return n}let ar;function Pa(n){return ar||(ar=typeof document>"u"?{}:document.createElement("a")),ar.href=n,ar.href}function li(n){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:u}=n,{width:f,height:r}=t,e=n.sdfCanvas.getContext("webgl");let i=u.image.data;(!i||i.length!==f*r*4)&&(i=new Uint8Array(f*r*4),u.image={width:f,height:r,data:i},u.flipY=!1,u.isDataTexture=!0),e.readPixels(0,0,f,r,e.RGBA,e.UNSIGNED_BYTE,i)}}const Oa=_t({name:"Typesetter",dependencies:[Ta,Sa,oa],init(n,t,u){return n(t,u())}}),ui=_t({name:"Typesetter",dependencies:[Oa],init(n){return function(t){return new Promise(u=>{n.typeset(t,u)})}},getTransferables(n){const t=[];for(let u in n)n[u]&&n[u].buffer&&t.push(n[u].buffer);return t}});ui.onMainThread;const kn={};function Ia(n){let t=kn[n];return t||(t=kn[n]=new Yr(1,1,n,n).translate(.5,.5,0)),t}const Ga="aTroikaGlyphBounds",Pn="aTroikaGlyphIndex",La="aTroikaGlyphColor";class za extends Ri{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Fi,this.boundingBox=new Jn}computeBoundingSphere(){}computeBoundingBox(){}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let u=Ia(t);["position","normal","uv"].forEach(f=>{this.attributes[f]=u.attributes[f].clone()}),this.setIndex(u.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,u,f,r,e){this.updateAttributeData(Ga,t,4),this.updateAttributeData(Pn,u,1),this.updateAttributeData(La,e,3),this._blockBounds=f,this._chunkedBounds=r,this.instanceCount=u.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:u,boundingBox:f}=this;if(u){const{PI:r,floor:e,min:i,max:s,sin:a,cos:o}=Math,l=r/2,c=r*2,h=Math.abs(u),d=t[0]/h,v=t[2]/h,g=e((d+l)/c)!==e((v+l)/c)?-h:i(a(d)*h,a(v)*h),m=e((d-l)/c)!==e((v-l)/c)?h:s(a(d)*h,a(v)*h),F=e((d+r)/c)!==e((v+r)/c)?h*2:s(h-o(d)*h,h-o(v)*h);f.min.set(g,t[1],u<0?-F:0),f.max.set(m,t[3],u<0?0:F)}else f.min.set(t[0],t[1],0),f.max.set(t[2],t[3],0);f.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let u=this.getAttribute(Pn).count,f=this._chunkedBounds;if(f)for(let r=f.length;r--;){u=f[r].end;let e=f[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=u}updateAttributeData(t,u,f){const r=this.getAttribute(t);u?r&&r.array.length===u.length?(r.array.set(u),r.needsUpdate=!0):(this.setAttribute(t,new Bi(u,f)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(t)}}const Na=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Ha=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Wa=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,ja=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Va(n){const t=Hr(n,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new ke},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ur(0,0,0,0)},uTroikaClipRect:{value:new ur(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new ke},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new pt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new ki},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Na,vertexTransform:Ha,fragmentDefs:Wa,fragmentColorTransform:ja,customRewriter({vertexShader:u,fragmentShader:f}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(f)&&(f=f.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(u)||(u=u.replace(ii,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:u,fragmentShader:f}}});return t.transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const Qr=new Zn({color:16777215,side:It,transparent:!0}),On=8421504,In=new Ci,sr=new Xr,Pr=new Xr,Ot=[],Xa=new Xr,Or="+x+y";function Gn(n){return Array.isArray(n)?n[0]:n}let fi=()=>{const n=new hr(new Yr(1,1),Qr);return fi=()=>n,n},ci=()=>{const n=new hr(new Yr(1,1,32,1),Qr);return ci=()=>n,n};const Ya={type:"syncstart"},Ka={type:"synccomplete"},hi=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Za=hi.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let di=class extends hr{constructor(){const t=new za;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=On,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=Or,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(Ya),si({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},u=>{this._isSyncing=!1,this._textRenderInfo=u,this.geometry.updateGlyphs(u.glyphBounds,u.glyphAtlasIndices,u.blockBounds,u.chunkedBounds,u.glyphColors);const f=this._queuedSyncs;f&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{f.forEach(r=>r&&r())})),this.dispatchEvent(Ka),t&&t()})))}onBeforeRender(t,u,f,r,e,i){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(t){return Va(t)}get material(){let t=this._derivedMaterial;const u=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=Qr.clone());if((!t||!t.isDerivedFrom(u))&&(t=this._derivedMaterial=this.createDerivedMaterial(u),u.addEventListener("dispose",function f(){u.removeEventListener("dispose",f),t.dispose()})),this.hasOutline()){let f=t._outlineMtl;return f||(f=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),f.isTextOutlineMaterial=!0,f.depthWrite=!1,f.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),f.dispose()})),[f,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return Gn(this.material).getDepthMaterial()}set customDepthMaterial(t){}get customDistanceMaterial(){return Gn(this.material).getDistanceMaterial()}set customDistanceMaterial(t){}_prepareForRender(t){const u=t.isTextOutlineMaterial,f=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:s,blockBounds:a}=r;f.uTroikaSDFTexture.value=s,f.uTroikaSDFTextureSize.value.set(s.image.width,s.image.height),f.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,f.uTroikaSDFExponent.value=r.sdfExponent,f.uTroikaTotalBounds.value.fromArray(a),f.uTroikaUseGlyphColors.value=!u&&!!r.glyphColors;let o=0,l=0,c=0,h,d,v,g=0,m=0;if(u){let{outlineWidth:x,outlineOffsetX:S,outlineOffsetY:b,outlineBlur:U,outlineOpacity:P}=this;o=this._parsePercent(x)||0,l=Math.max(0,this._parsePercent(U)||0),h=P,g=this._parsePercent(S)||0,m=this._parsePercent(b)||0}else c=Math.max(0,this._parsePercent(this.strokeWidth)||0),c&&(v=this.strokeColor,f.uTroikaStrokeColor.value.set(v??On),d=this.strokeOpacity,d==null&&(d=1)),h=this.fillOpacity;f.uTroikaEdgeOffset.value=o,f.uTroikaPositionOffset.value.set(g,m),f.uTroikaBlurRadius.value=l,f.uTroikaStrokeWidth.value=c,f.uTroikaStrokeOpacity.value=d,f.uTroikaFillOpacity.value=h??1,f.uTroikaCurveRadius.value=this.curveRadius||0;let F=this.clipRect;if(F&&Array.isArray(F)&&F.length===4)f.uTroikaClipRect.value.fromArray(F);else{const x=(this.fontSize||.1)*100;f.uTroikaClipRect.value.set(a[0]-x,a[1]-x,a[2]+x,a[3]+x)}this.geometry.applyClipRect(f.uTroikaClipRect.value)}f.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=u?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const s=t.hasOwnProperty("color")?t.color:t.color=new pt;(e!==s._input||typeof e=="object")&&s.set(s._input=e)}let i=this.orientation||Or;if(i!==t._orientation){let s=f.uTroikaOrient.value;i=i.replace(/[^-+xyz]/g,"");let a=i!==Or&&i.match(/^([-+])([xyz])([-+])([xyz])$/);if(a){let[,o,l,c,h]=a;sr.set(0,0,0)[l]=o==="-"?1:-1,Pr.set(0,0,0)[h]=c==="-"?-1:1,In.lookAt(Xa,sr.cross(Pr),Pr),s.setFromMatrix4(In)}else s.identity();t._orientation=i}}_parsePercent(t){if(typeof t=="string"){let u=t.match(/^(-?[\d.]+)%$/),f=u?parseFloat(u[1]):NaN;t=(isNaN(f)?0:f/100)*this.fontSize}return t}localPositionToTextCoords(t,u=new ke){u.copy(t);const f=this.curveRadius;return f&&(u.x=Math.atan2(t.x,Math.abs(f)-Math.abs(t.z))*Math.abs(f)),u}worldPositionToTextCoords(t,u=new ke){return sr.copy(t),this.localPositionToTextCoords(this.worldToLocal(sr),u)}raycast(t,u){const{textRenderInfo:f,curveRadius:r}=this;if(f){const e=f.blockBounds,i=r?ci():fi(),s=i.geometry,{position:a,uv:o}=s.attributes;for(let l=0;l<o.count;l++){let c=e[0]+o.getX(l)*(e[2]-e[0]);const h=e[1]+o.getY(l)*(e[3]-e[1]);let d=0;r&&(d=r-Math.cos(c/r)*r,c=Math.sin(c/r)*r),a.setXYZ(l,c,h,d)}s.boundingSphere=this.geometry.boundingSphere,s.boundingBox=this.geometry.boundingBox,i.matrixWorld=this.matrixWorld,i.material.side=this.material.side,Ot.length=0,i.raycast(t,Ot);for(let l=0;l<Ot.length;l++)Ot[l].object=this,u.push(Ot[l])}}copy(t){const u=this.geometry;return super.copy(t),this.geometry=u,Za.forEach(f=>{this[f]=t[f]}),this}clone(){return new this.constructor().copy(this)}};hi.forEach(n=>{const t="_private_"+n;Object.defineProperty(di.prototype,n,{get(){return this[t]},set(u){u!==this[t]&&(this[t]=u,this._needsSync=!0)}})});new Jn;new pt;const Ja=Se.forwardRef(({sdfGlyphSize:n=64,anchorX:t="center",anchorY:u="middle",font:f,fontSize:r=1,children:e,characters:i,onSync:s,...a},o)=>{const l=Wt(({invalidate:v})=>v),[c]=Se.useState(()=>new di),[h,d]=Se.useMemo(()=>{const v=[];let g="";return Se.Children.forEach(e,m=>{typeof m=="string"||typeof m=="number"?g+=m:v.push(m)}),[v,g]},[e]);return Pi(()=>new Promise(v=>Ba({font:f,characters:i},v)),["troika-text",f,i]),Se.useLayoutEffect(()=>void c.sync(()=>{l(),s&&s(c)})),Se.useEffect(()=>()=>c.dispose(),[c]),Se.createElement("primitive",cr({object:c,ref:o,font:f,text:d,anchorX:t,anchorY:u,fontSize:r,sdfGlyphSize:n},a),h)}),Ir=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function qr(n,t){const u=Wt(e=>e.gl),f=Kr(Zr,Ir(n)?Object.values(n):n);return Se.useLayoutEffect(()=>{t?.(f)},[t]),Se.useEffect(()=>{if("initTexture"in u){let e=[];Array.isArray(f)?e=f:f instanceof Ht?e=[f]:Ir(f)&&(e=Object.values(f)),e.forEach(i=>{i instanceof Ht&&u.initTexture(i)})}},[u,f]),Se.useMemo(()=>{if(Ir(n)){const e={};let i=0;for(const s in n)e[s]=f[i++];return e}else return f},[n,f])}qr.preload=n=>Kr.preload(Zr,n);qr.clear=n=>Kr.clear(Zr,n);var Qa=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class qa extends Oi{constructor(t={}){super(t),this.setValues(t),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(t){t.uniforms.time=this._time,t.uniforms.radius=this._radius,t.uniforms.distort=this._distort,t.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${Qa}
      ${t.vertexShader}
    `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(t){this._time.value=t}get distort(){return this._distort.value}set distort(t){this._distort.value=t}get radius(){return this._radius.value}set radius(t){this._radius.value=t}}const $a=Se.forwardRef(({speed:n=1,...t},u)=>{const[f]=Se.useState(()=>new qa);return jt(r=>f&&(f.time=r.clock.elapsedTime*n)),Se.createElement("primitive",cr({object:f,ref:u,attach:"material"},t))});/**
 * postprocessing v6.37.6 build Fri Jul 04 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rschen
 * @license Zlib
 */var Gr=1/1e3,es=1e3,ts=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Gr}get fixedDelta(){return this._fixedDelta*Gr}set fixedDelta(n){this._fixedDelta=n*es}get elapsed(){return this._elapsed*Gr}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},rs=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]),u=new Xi;return u.setAttribute("position",new Un(n,3)),u.setAttribute("uv",new Un(t,2)),u})(),Xe=class jr{static get fullscreenGeometry(){return rs}constructor(t="Pass",u=new wn,f=new Wi){this.name=t,this.renderer=null,this.scene=u,this.camera=f,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){const u=this.fullscreenMaterial;u!==null&&(u.needsUpdate=!0),this.rtt=!t}}set mainScene(t){}set mainCamera(t){}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let u=this.screen;u!==null?u.material=t:(u=new hr(jr.fullscreenGeometry,t),u.frustumCulled=!1,this.scene===null&&(this.scene=new wn),this.scene.add(u),this.screen=u)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,u=Ut){}render(t,u,f,r,e){throw new Error("Render method not implemented!")}setSize(t,u){}initialize(t,u,f){}dispose(){for(const t of Object.keys(this)){const u=this[t];(u instanceof $e||u instanceof $n||u instanceof Ht||u instanceof jr)&&this[t].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},ns=class extends Xe{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,t,u,f,r){const e=n.state.buffers.stencil;e.setLocked(!1),e.setTest(!1)}},is=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,vi="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",pi=class extends rt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Ue(null),opacity:new Ue(1)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:is,vertexShader:vi})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},as=class extends Xe{constructor(n,t=!0){super("CopyPass"),this.fullscreenMaterial=new pi,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new $e(1,1,{minFilter:wt,magFilter:wt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,t,u,f,r){this.fullscreenMaterial.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){this.autoResize&&this.renderTarget.setSize(n,t)}initialize(n,t,u){u!==void 0&&(this.renderTarget.texture.type=u,u!==vt?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Le&&(this.renderTarget.texture.colorSpace=Le))}},Ln=new pt,gi=class extends Xe{constructor(n=!0,t=!0,u=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=t,this.stencil=u,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,t,u){this.color=n,this.depth=t,this.stencil=u}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,t,u,f,r){const e=this.overrideClearColor,i=this.overrideClearAlpha,s=n.getClearAlpha(),a=e!==null,o=i>=0;a?(n.getClearColor(Ln),n.setClearColor(e,o?i:s)):o&&n.setClearAlpha(i),n.setRenderTarget(this.renderToScreen?null:t),n.clear(this.color,this.depth,this.stencil),a?n.setClearColor(Ln,s):o&&n.setClearAlpha(s)}},ss=class extends Xe{constructor(n,t){super("MaskPass",n,t),this.needsSwap=!1,this.clearPass=new gi(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,t,u,f,r){const e=n.getContext(),i=n.state.buffers,s=this.scene,a=this.camera,o=this.clearPass,l=this.inverted?0:1,c=1-l;i.color.setMask(!1),i.depth.setMask(!1),i.color.setLocked(!0),i.depth.setLocked(!0),i.stencil.setTest(!0),i.stencil.setOp(e.REPLACE,e.REPLACE,e.REPLACE),i.stencil.setFunc(e.ALWAYS,l,4294967295),i.stencil.setClear(c),i.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?o.render(n,null):(o.render(n,t),o.render(n,u))),this.renderToScreen?(n.setRenderTarget(null),n.render(s,a)):(n.setRenderTarget(t),n.render(s,a),n.setRenderTarget(u),n.render(s,a)),i.color.setLocked(!1),i.depth.setLocked(!1),i.stencil.setLocked(!1),i.stencil.setFunc(e.EQUAL,1,4294967295),i.stencil.setOp(e.KEEP,e.KEEP,e.KEEP),i.stencil.setLocked(!0)}},os=class{constructor(n=null,{depthBuffer:t=!0,stencilBuffer:u=!1,multisampling:f=0,frameBufferType:r}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,u,r,f),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new as,this.depthTexture=null,this.passes=[],this.timer=new ts,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const t=this.inputBuffer,u=this.multisampling;u>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):u!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const t=n.getSize(new ke),u=n.getContext().getContextAttributes().alpha,f=this.inputBuffer.texture.type;f===vt&&n.outputColorSpace===Le&&(this.inputBuffer.texture.colorSpace=Le,this.outputBuffer.texture.colorSpace=Le,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(t.width,t.height);for(const r of this.passes)r.initialize(n,u,f)}}replaceRenderer(n,t=!0){const u=this.renderer,f=u.domElement.parentNode;return this.setRenderer(n),t&&f!==null&&(f.removeChild(u.domElement),f.appendChild(n.domElement)),u}createDepthTexture(){const n=this.depthTexture=new Ii;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Gi,n.type=Li):n.type=zi,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,t,u,f){const r=this.renderer,e=r===null?new ke:r.getDrawingBufferSize(new ke),i={minFilter:wt,magFilter:wt,stencilBuffer:t,depthBuffer:n,type:u},s=new $e(e.width,e.height,i);return f>0&&(s.ignoreDepthForMultisampleCopy=!1,s.samples=f),u===vt&&r!==null&&r.outputColorSpace===Le&&(s.texture.colorSpace=Le),s.texture.name="EffectComposer.Buffer",s.texture.generateMipmaps=!1,s}setMainScene(n){for(const t of this.passes)t.mainScene=n}setMainCamera(n){for(const t of this.passes)t.mainCamera=n}addPass(n,t){const u=this.passes,f=this.renderer,r=f.getDrawingBufferSize(new ke),e=f.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;if(n.setRenderer(f),n.setSize(r.width,r.height),n.initialize(f,e,i),this.autoRenderToScreen&&(u.length>0&&(u[u.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?u.splice(t,0,n):u.push(n),this.autoRenderToScreen&&(u[u.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const s=this.createDepthTexture();for(n of u)n.setDepthTexture(s)}else n.setDepthTexture(this.depthTexture)}removePass(n){const t=this.passes,u=t.indexOf(n);if(u!==-1&&t.splice(u,1).length>0){if(this.depthTexture!==null){const e=(s,a)=>s||a.needsDepthTexture;t.reduce(e,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&u===t.length&&(n.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const t=this.renderer,u=this.copyPass;let f=this.inputBuffer,r=this.outputBuffer,e=!1,i,s,a;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const o of this.passes)o.enabled&&(o.render(t,f,r,n,e),o.needsSwap&&(e&&(u.renderToScreen=o.renderToScreen,i=t.getContext(),s=t.state.buffers.stencil,s.setFunc(i.NOTEQUAL,1,4294967295),u.render(t,f,r,n,e),s.setFunc(i.EQUAL,1,4294967295)),a=f,f=r,r=a),o instanceof ss?e=!0:o instanceof ns&&(e=!1))}setSize(n,t,u){const f=this.renderer,r=f.getSize(new ke);(n===void 0||t===void 0)&&(n=r.width,t=r.height),(r.width!==n||r.height!==t)&&f.setSize(n,t,u);const e=f.getDrawingBufferSize(new ke);this.inputBuffer.setSize(e.width,e.height),this.outputBuffer.setSize(e.width,e.height);for(const i of this.passes)i.setSize(e.width,e.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Xe.fullscreenGeometry.dispose()}},dt={NONE:0,DEPTH:1,CONVOLUTION:2},Te={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},ls=class{constructor(){this.shaderParts=new Map([[Te.FRAGMENT_HEAD,null],[Te.FRAGMENT_MAIN_UV,null],[Te.FRAGMENT_MAIN_IMAGE,null],[Te.VERTEX_HEAD,null],[Te.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=dt.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Qn}},Lr=!1,zn=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let u;if(t.material.flatShading)switch(t.material.side){case It:u=this.materialsFlatShadedDoubleSide;break;case ir:u=this.materialsFlatShadedBackSide;break;default:u=this.materialsFlatShaded;break}else switch(t.material.side){case It:u=this.materialsDoubleSide;break;case ir:u=this.materialsBackSide;break;default:u=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=u[2]:t.isInstancedMesh?t.material=u[1]:t.material=u[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof rt))return n.clone();const t=n.uniforms,u=new Map;for(const r in t){const e=t[r].value;e.isRenderTargetTexture&&(t[r].value=null,u.set(r,e))}const f=n.clone();for(const r of u)t[r[0]].value=r[1],f.uniforms[r[0]].value=r[1];return f}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const t=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const u of t)u.uniforms=Object.assign({},n.uniforms),u.side=ji;t[2].skinning=!0,this.materialsBackSide=t.map(u=>{const f=this.cloneMaterial(u);return f.uniforms=Object.assign({},n.uniforms),f.side=ir,f}),this.materialsDoubleSide=t.map(u=>{const f=this.cloneMaterial(u);return f.uniforms=Object.assign({},n.uniforms),f.side=It,f}),this.materialsFlatShaded=t.map(u=>{const f=this.cloneMaterial(u);return f.uniforms=Object.assign({},n.uniforms),f.flatShading=!0,f}),this.materialsFlatShadedBackSide=t.map(u=>{const f=this.cloneMaterial(u);return f.uniforms=Object.assign({},n.uniforms),f.flatShading=!0,f.side=ir,f}),this.materialsFlatShadedDoubleSide=t.map(u=>{const f=this.cloneMaterial(u);return f.uniforms=Object.assign({},n.uniforms),f.flatShading=!0,f.side=It,f})}}render(n,t,u){const f=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,Lr){const r=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),n.render(t,u);for(const e of r)e[0].material=e[1];this.meshCount!==r.size&&r.clear()}else{const r=t.overrideMaterial;t.overrideMaterial=this.material,n.render(t,u),t.overrideMaterial=r}n.shadowMap.enabled=f}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const t of n)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Lr}static set workaroundEnabled(n){Lr=n}},lt=-1,ze=class extends Jr{constructor(n,t=lt,u=lt,f=1){super(),this.resizable=n,this.baseSize=new ke(1,1),this.preferredSize=new ke(t,u),this.target=this.preferredSize,this.s=f,this.effectiveSize=new ke,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,t=this.preferredSize,u=this.effectiveSize,f=this.scale;t.width!==lt?u.width=t.width:t.height!==lt?u.width=Math.round(t.height*(n.width/Math.max(n.height,1))):u.width=Math.round(n.width*f),t.height!==lt?u.height=t.height:t.width!==lt?u.height=Math.round(t.width/Math.max(n.width/Math.max(n.height,1),1)):u.height=Math.round(n.height*f)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(lt),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,t){(this.baseSize.width!==n||this.baseSize.height!==t)&&(this.baseSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,t){(this.preferredSize.width!==n||this.preferredSize.height!==t)&&(this.preferredSize.set(n,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return lt}},be={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},us="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),opacity);}",fs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",cs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),opacity);}",hs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",ds="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),opacity);}",vs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),opacity);}",ps="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),opacity);}",gs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),opacity);}",ms="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),opacity);}",ys="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),opacity);}",xs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),opacity);}",bs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),opacity);}",Ss="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),opacity);}",Ts="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),opacity);}",ws="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),opacity);}",Us="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),opacity);}",_s="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",Es="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),opacity);}",Ms="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),opacity);}",Ds="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),opacity);}",As="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),opacity);}",Cs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),opacity);}",Rs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Fs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),opacity);}",Bs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),opacity);}",ks="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),opacity);}",Ps="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),opacity);}",Os="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),opacity);}",Is="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),opacity);}",Gs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",Ls="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),opacity);}",zs="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),opacity);}",Ns=new Map([[be.ADD,us],[be.ALPHA,fs],[be.AVERAGE,cs],[be.COLOR,hs],[be.COLOR_BURN,ds],[be.COLOR_DODGE,vs],[be.DARKEN,ps],[be.DIFFERENCE,gs],[be.DIVIDE,ms],[be.DST,null],[be.EXCLUSION,ys],[be.HARD_LIGHT,xs],[be.HARD_MIX,bs],[be.HUE,Ss],[be.INVERT,Ts],[be.INVERT_RGB,ws],[be.LIGHTEN,Us],[be.LINEAR_BURN,_s],[be.LINEAR_DODGE,Es],[be.LINEAR_LIGHT,Ms],[be.LUMINOSITY,Ds],[be.MULTIPLY,As],[be.NEGATION,Cs],[be.NORMAL,Rs],[be.OVERLAY,Fs],[be.PIN_LIGHT,Bs],[be.REFLECT,ks],[be.SATURATION,Ps],[be.SCREEN,Os],[be.SOFT_LIGHT,Is],[be.SRC,Gs],[be.SUBTRACT,Ls],[be.VIVID_LIGHT,zs]]),Hs=class extends Jr{constructor(n,t=1){super(),this._blendFunction=n,this.opacity=new Ue(t)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return Ns.get(this.blendFunction)}},Vr=class extends Jr{constructor(n,t,{attributes:u=dt.NONE,blendFunction:f=be.NORMAL,defines:r=new Map,uniforms:e=new Map,extensions:i=null,vertexShader:s=null}={}){super(),this.name=n,this.renderer=null,this.attributes=u,this.fragmentShader=t,this.vertexShader=s,this.defines=r,this.uniforms=e,this.extensions=i,this.blendMode=new Hs(f),this.blendMode.addEventListener("change",a=>this.setChanged()),this._inputColorSpace=Qn,this._outputColorSpace=qn}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,t=Ut){}update(n,t,u){}setSize(n,t){}initialize(n,t,u){}dispose(){for(const n of Object.keys(this)){const t=this[n];(t instanceof $e||t instanceof $n||t instanceof Ht||t instanceof Xe)&&this[n].dispose()}}},$r={MEDIUM:2,LARGE:3},Ws=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,js="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Vs=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Xs=class extends rt{constructor(n=new ur){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Ue(null),texelSize:new Ue(new ur),scale:new Ue(1),kernel:new Ue(0)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ws,vertexShader:js}),this.setTexelSize(n.x,n.y),this.kernelSize=$r.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Vs[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t,n*.5,t*.5)}setSize(n,t){const u=1/n,f=1/t;this.uniforms.texelSize.value.set(u,f,u*.5,f*.5)}},Ys=class extends Xe{constructor({kernelSize:n=$r.MEDIUM,resolutionScale:t=.5,width:u=ze.AUTO_SIZE,height:f=ze.AUTO_SIZE,resolutionX:r=u,resolutionY:e=f}={}){super("KawaseBlurPass"),this.renderTargetA=new $e(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const i=this.resolution=new ze(this,r,e,t);i.addEventListener("change",s=>this.setSize(i.baseWidth,i.baseHeight)),this._blurMaterial=new Xs,this._blurMaterial.kernelSize=n,this.copyMaterial=new pi}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,u,f,r){const e=this.scene,i=this.camera,s=this.renderTargetA,a=this.renderTargetB,o=this.blurMaterial,l=o.kernelSequence;let c=t;this.fullscreenMaterial=o;for(let h=0,d=l.length;h<d;++h){const v=(h&1)===0?s:a;o.kernel=l[h],o.inputBuffer=c.texture,n.setRenderTarget(v),n.render(e,i),c=v}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=c.texture,n.setRenderTarget(this.renderToScreen?null:u),n.render(e,i)}setSize(n,t){const u=this.resolution;u.setBaseSize(n,t);const f=u.width,r=u.height;this.renderTargetA.setSize(f,r),this.renderTargetB.setSize(f,r),this.blurMaterial.setSize(n,t)}initialize(n,t,u){u!==void 0&&(this.renderTargetA.texture.type=u,this.renderTargetB.texture.type=u,u!==vt?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Le&&(this.renderTargetA.texture.colorSpace=Le,this.renderTargetB.texture.colorSpace=Le))}static get AUTO_SIZE(){return ze.AUTO_SIZE}},Ks=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,Zs=class extends rt{constructor(n=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:ei.replace(/\D+/g,"")},uniforms:{inputBuffer:new Ue(null),threshold:new Ue(0),smoothing:new Ue(1),range:new Ue(null)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Ks,vertexShader:vi}),this.colorOutput=n,this.luminanceRange=t}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Js=class extends Xe{constructor({renderTarget:n,luminanceRange:t,colorOutput:u,resolutionScale:f=1,width:r=ze.AUTO_SIZE,height:e=ze.AUTO_SIZE,resolutionX:i=r,resolutionY:s=e}={}){super("LuminancePass"),this.fullscreenMaterial=new Zs(u,t),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new $e(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const a=this.resolution=new ze(this,i,s,f);a.addEventListener("change",o=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,t,u,f,r){const e=this.fullscreenMaterial;e.inputBuffer=t.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const u=this.resolution;u.setBaseSize(n,t),this.renderTarget.setSize(u.width,u.height)}initialize(n,t,u){u!==void 0&&u!==vt&&(this.renderTarget.texture.type=u,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Qs=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,qs="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",$s=class extends rt{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Ue(null),texelSize:new Ue(new ke)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Qs,vertexShader:qs})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},eo=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,to="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",ro=class extends rt{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Ue(null),supportBuffer:new Ue(null),texelSize:new Ue(new ke),radius:new Ue(.85)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:eo,vertexShader:to})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},no=class extends Xe{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new $e(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new $s,this.upsamplingMaterial=new ro,this.resolution=new ke}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const t=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let u=0;u<n;++u){const f=t.clone();f.texture.name="Downsampling.Mipmap"+u,this.downsamplingMipmaps.push(f)}this.upsamplingMipmaps.push(t);for(let u=1,f=n-1;u<f;++u){const r=t.clone();r.texture.name="Upsampling.Mipmap"+u,this.upsamplingMipmaps.push(r)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,t,u,f,r){const{scene:e,camera:i}=this,{downsamplingMaterial:s,upsamplingMaterial:a}=this,{downsamplingMipmaps:o,upsamplingMipmaps:l}=this;let c=t;this.fullscreenMaterial=s;for(let h=0,d=o.length;h<d;++h){const v=o[h];s.setSize(c.width,c.height),s.inputBuffer=c.texture,n.setRenderTarget(v),n.render(e,i),c=v}this.fullscreenMaterial=a;for(let h=l.length-1;h>=0;--h){const d=l[h];a.setSize(c.width,c.height),a.inputBuffer=c.texture,a.supportBuffer=o[h].texture,n.setRenderTarget(d),n.render(e,i),c=d}}setSize(n,t){const u=this.resolution;u.set(n,t);let f=u.width,r=u.height;for(let e=0,i=this.downsamplingMipmaps.length;e<i;++e)f=Math.round(f*.5),r=Math.round(r*.5),this.downsamplingMipmaps[e].setSize(f,r),e<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[e].setSize(f,r)}initialize(n,t,u){if(u!==void 0){const f=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const r of f)r.texture.type=u;if(u!==vt)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Le)for(const r of f)r.texture.colorSpace=Le}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},io=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,ao=class extends Vr{constructor({blendFunction:n=be.SCREEN,luminanceThreshold:t=1,luminanceSmoothing:u=.03,mipmapBlur:f=!0,intensity:r=1,radius:e=.85,levels:i=8,kernelSize:s=$r.LARGE,resolutionScale:a=.5,width:o=ze.AUTO_SIZE,height:l=ze.AUTO_SIZE,resolutionX:c=o,resolutionY:h=l}={}){super("BloomEffect",io,{blendFunction:n,uniforms:new Map([["map",new Ue(null)],["intensity",new Ue(r)]])}),this.renderTarget=new $e(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Ys({kernelSize:s}),this.luminancePass=new Js({colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothing=u,this.mipmapBlurPass=new no,this.mipmapBlurPass.enabled=f,this.mipmapBlurPass.radius=e,this.mipmapBlurPass.levels=i,this.uniforms.get("map").value=f?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new ze(this,c,h,a);d.addEventListener("change",v=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,t,u){const f=this.renderTarget,r=this.luminancePass;r.enabled?(r.render(n,t),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,r.renderTarget):this.blurPass.render(n,r.renderTarget,f)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,t):this.blurPass.render(n,t,f)}setSize(n,t){const u=this.resolution;u.setBaseSize(n,t),this.renderTarget.setSize(u.width,u.height),this.blurPass.resolution.copy(u),this.luminancePass.setSize(n,t),this.mipmapBlurPass.setSize(n,t)}initialize(n,t,u){this.blurPass.initialize(n,t,u),this.luminancePass.initialize(n,t,u),this.mipmapBlurPass.initialize(n,t,u),u!==void 0&&(this.renderTarget.texture.type=u,n!==null&&n.outputColorSpace===Le&&(this.renderTarget.texture.colorSpace=Le))}},mi=class extends Xe{constructor(n,t,u=null){super("RenderPass",n,t),this.needsSwap=!1,this.clearPass=new gi,this.overrideMaterialManager=u===null?null:new zn(u),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const t=this.overrideMaterialManager;n!==null?t!==null?t.setMaterial(n):this.overrideMaterialManager=new zn(n):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,t,u,f,r){const e=this.scene,i=this.camera,s=this.selection,a=i.layers.mask,o=e.background,l=n.shadowMap.autoUpdate,c=this.renderToScreen?null:t;s!==null&&i.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(e.background=null),this.clearPass.enabled&&this.clearPass.render(n,t),n.setRenderTarget(c),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,e,i):n.render(e,i),i.layers.mask=a,e.background=o,n.shadowMap.autoUpdate=l}},so=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,oo="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",lo=class extends rt{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ue(null),normalBuffer:new Ue(null),texelSize:new Ue(new ke)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:so,vertexShader:oo})}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Ut){this.depthBuffer=n,this.depthPacking=t}set normalBuffer(n){this.uniforms.normalBuffer.value=n,n!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(n){this.normalBuffer=n}setTexelSize(n,t){this.uniforms.texelSize.value.set(n,t)}setSize(n,t){this.uniforms.texelSize.value.set(1/n,1/t)}},uo=class extends Xe{constructor({normalBuffer:n=null,resolutionScale:t=.5,width:u=ze.AUTO_SIZE,height:f=ze.AUTO_SIZE,resolutionX:r=u,resolutionY:e=f}={}){super("DepthDownsamplingPass");const i=new lo;i.normalBuffer=n,this.fullscreenMaterial=i,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new $e(1,1,{minFilter:fr,magFilter:fr,depthBuffer:!1,type:Hi}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const s=this.resolution=new ze(this,r,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(n,t=Ut){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t}render(n,t,u,f,r){n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,t){const u=this.resolution;u.setBaseSize(n,t),this.renderTarget.setSize(u.width,u.height),this.fullscreenMaterial.setSize(n,t)}initialize(n,t,u){const f=n.getContext();if(!(f.getExtension("EXT_color_buffer_float")||f.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},fo=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,co="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",ho=class extends rt{constructor(n,t,u,f,r=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:ei.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Ue(null),depthBuffer:new Ue(null),resolution:new Ue(new ke),texelSize:new Ue(new ke),cameraNear:new Ue(.3),cameraFar:new Ue(1e3),aspect:new Ue(1),time:new Ue(0)},blending:gt,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:r}),n&&this.setShaderParts(n),t&&this.setDefines(t),u&&this.setUniforms(u),this.copyCameraSettings(f)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,t=Ut){this.depthBuffer=n,this.depthPacking=t}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=fo.replace(Te.FRAGMENT_HEAD,n.get(Te.FRAGMENT_HEAD)||"").replace(Te.FRAGMENT_MAIN_UV,n.get(Te.FRAGMENT_MAIN_UV)||"").replace(Te.FRAGMENT_MAIN_IMAGE,n.get(Te.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=co.replace(Te.VERTEX_HEAD,n.get(Te.VERTEX_HEAD)||"").replace(Te.VERTEX_MAIN_SUPPORT,n.get(Te.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const t of n.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(n){for(const t of n.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(n){this.extensions={};for(const t of n)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Vi?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,t){const u=this.uniforms;u.resolution.value.set(n,t),u.texelSize.value.set(1/n,1/t),u.aspect.value=n/t}static get Section(){return Te}};function Nn(n,t,u){for(const f of t){const r="$1"+n+f.charAt(0).toUpperCase()+f.slice(1),e=new RegExp("([^\\.])(\\b"+f+"\\b)","g");for(const i of u.entries())i[1]!==null&&u.set(i[0],i[1].replace(e,r))}}function vo(n,t,u){let f=t.getFragmentShader(),r=t.getVertexShader();const e=f!==void 0&&/mainImage/.test(f),i=f!==void 0&&/mainUv/.test(f);if(u.attributes|=t.getAttributes(),f===void 0)throw new Error(`Missing fragment shader (${t.name})`);if(i&&(u.attributes&dt.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${t.name})`);if(!e&&!i)throw new Error(`Could not find mainImage or mainUv function (${t.name})`);{const s=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,a=u.shaderParts;let o=a.get(Te.FRAGMENT_HEAD)||"",l=a.get(Te.FRAGMENT_MAIN_UV)||"",c=a.get(Te.FRAGMENT_MAIN_IMAGE)||"",h=a.get(Te.VERTEX_HEAD)||"",d=a.get(Te.VERTEX_MAIN_SUPPORT)||"";const v=new Set,g=new Set;if(i&&(l+=`	${n}MainUv(UV);
`,u.uvTransformation=!0),r!==null&&/mainSupport/.test(r)){const x=/mainSupport *\([\w\s]*?uv\s*?\)/.test(r);d+=`	${n}MainSupport(`,d+=x?`vUv);
`:`);
`;for(const S of r.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const b of S[1].split(/\s*,\s*/))u.varyings.add(b),v.add(b),g.add(b);for(const S of r.matchAll(s))g.add(S[1])}for(const x of f.matchAll(s))g.add(x[1]);for(const x of t.defines.keys())g.add(x.replace(/\([\w\s,]*\)/g,""));for(const x of t.uniforms.keys())g.add(x);g.delete("while"),g.delete("for"),g.delete("if"),t.uniforms.forEach((x,S)=>u.uniforms.set(n+S.charAt(0).toUpperCase()+S.slice(1),x)),t.defines.forEach((x,S)=>u.defines.set(n+S.charAt(0).toUpperCase()+S.slice(1),x));const m=new Map([["fragment",f],["vertex",r]]);Nn(n,g,u.defines),Nn(n,g,m),f=m.get("fragment"),r=m.get("vertex");const F=t.blendMode;if(u.blendModes.set(F.blendFunction,F),e){t.inputColorSpace!==null&&t.inputColorSpace!==u.colorSpace&&(c+=t.inputColorSpace===Le?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),t.outputColorSpace!==qn?u.colorSpace=t.outputColorSpace:t.inputColorSpace!==null&&(u.colorSpace=t.inputColorSpace);const x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;c+=`${n}MainImage(color0, UV, `,(u.attributes&dt.DEPTH)!==0&&x.test(f)&&(c+="depth, ",u.readDepth=!0),c+=`color1);
	`;const S=n+"BlendOpacity";u.uniforms.set(S,F.opacity),c+=`color0 = blend${F.blendFunction}(color0, color1, ${S});

	`,o+=`uniform float ${S};

`}if(o+=f+`
`,r!==null&&(h+=r+`
`),a.set(Te.FRAGMENT_HEAD,o),a.set(Te.FRAGMENT_MAIN_UV,l),a.set(Te.FRAGMENT_MAIN_IMAGE,c),a.set(Te.VERTEX_HEAD,h),a.set(Te.VERTEX_MAIN_SUPPORT,d),t.extensions!==null)for(const x of t.extensions)u.extensions.add(x)}}var po=class extends Xe{constructor(n,...t){super("EffectPass"),this.fullscreenMaterial=new ho(null,null,null,n),this.listener=u=>this.handleEvent(u),this.effects=[],this.setEffects(t),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const t of this.effects)t.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const t of this.effects)t.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const t=this.fullscreenMaterial;t.dithering=n,t.needsUpdate=!0}setEffects(n){for(const t of this.effects)t.removeEventListener("change",this.listener);this.effects=n.sort((t,u)=>u.attributes-t.attributes);for(const t of this.effects)t.addEventListener("change",this.listener)}updateMaterial(){const n=new ls;let t=0;for(const i of this.effects)if(i.blendMode.blendFunction===be.DST)n.attributes|=i.getAttributes()&dt.DEPTH;else{if((n.attributes&i.getAttributes()&dt.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${i.name})`);vo("e"+t++,i,n)}let u=n.shaderParts.get(Te.FRAGMENT_HEAD),f=n.shaderParts.get(Te.FRAGMENT_MAIN_IMAGE),r=n.shaderParts.get(Te.FRAGMENT_MAIN_UV);const e=/\bblend\b/g;for(const i of n.blendModes.values())u+=i.getShaderCode().replace(e,`blend${i.blendFunction}`)+`
`;(n.attributes&dt.DEPTH)!==0?(n.readDepth&&(f=`float depth = readDepth(UV);

	`+f),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Le&&(f+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(r=`vec2 transformedUv = vUv;
`+r,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Te.FRAGMENT_HEAD,u),n.shaderParts.set(Te.FRAGMENT_MAIN_IMAGE,f),n.shaderParts.set(Te.FRAGMENT_MAIN_UV,r);for(const[i,s]of n.shaderParts)s!==null&&n.shaderParts.set(i,s.trim().replace(/^#/,`
#`));this.skipRendering=t===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,t=Ut){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=t;for(const u of this.effects)u.setDepthTexture(n,t)}render(n,t,u,f,r){for(const e of this.effects)e.update(n,t,f);if(!this.skipRendering||this.renderToScreen){const e=this.fullscreenMaterial;e.inputBuffer=t.texture,e.time+=f*this.timeScale,n.setRenderTarget(this.renderToScreen?null:u),n.render(this.scene,this.camera)}}setSize(n,t){this.fullscreenMaterial.setSize(n,t);for(const u of this.effects)u.setSize(n,t)}initialize(n,t,u){this.renderer=n;for(const f of this.effects)f.initialize(n,t,u);this.updateMaterial(),u!==void 0&&u!==vt&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}},go=class extends Xe{constructor(n,t,{renderTarget:u,resolutionScale:f=1,width:r=ze.AUTO_SIZE,height:e=ze.AUTO_SIZE,resolutionX:i=r,resolutionY:s=e}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new mi(n,t,new Ni);const a=this.renderPass;a.ignoreBackground=!0,a.skipShadowMapUpdate=!0;const o=a.getClearPass();o.overrideClearColor=new pt(7829503),o.overrideClearAlpha=1,this.renderTarget=u,this.renderTarget===void 0&&(this.renderTarget=new $e(1,1,{minFilter:fr,magFilter:fr}),this.renderTarget.texture.name="NormalPass.Target");const l=this.resolution=new ze(this,i,s,f);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}set mainScene(n){this.renderPass.mainScene=n}set mainCamera(n){this.renderPass.mainCamera=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,t,u,f,r){const e=this.renderToScreen?null:this.renderTarget;this.renderPass.render(n,e,e)}setSize(n,t){const u=this.resolution;u.setBaseSize(n,t),this.renderTarget.setSize(u.width,u.height)}};function Nt(n,t,u){return t in n?Object.defineProperty(n,t,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[t]=u,n}new ke;new ke;function yi(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Ke=function n(t,u,f){var r=this;yi(this,n),Nt(this,"dot2",function(e,i){return r.x*e+r.y*i}),Nt(this,"dot3",function(e,i,s){return r.x*e+r.y*i+r.z*s}),this.x=t,this.y=u,this.z=f},mo=[new Ke(1,1,0),new Ke(-1,1,0),new Ke(1,-1,0),new Ke(-1,-1,0),new Ke(1,0,1),new Ke(-1,0,1),new Ke(1,0,-1),new Ke(-1,0,-1),new Ke(0,1,1),new Ke(0,-1,1),new Ke(0,1,-1),new Ke(0,-1,-1)],Hn=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Wn=new Array(512),jn=new Array(512),yo=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var u=0;u<256;u++){var f;u&1?f=Hn[u]^t&255:f=Hn[u]^t>>8&255,Wn[u]=Wn[u+256]=f,jn[u]=jn[u+256]=mo[f%12]}};yo(0);function xo(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var t=n;n=0;for(var u=0;u<t.length;u++)n=(n+(u+1)*(t.charCodeAt(u)%96))%2147483647}return n===0&&(n=311),n}function Vn(n){var t=xo(n);return function(){var u=t*48271%2147483647;return t=u,u/2147483647}}var bo=function n(t){var u=this;yi(this,n),Nt(this,"seed",0),Nt(this,"init",function(f){u.seed=f,u.value=Vn(f)}),Nt(this,"value",Vn(this.seed)),this.init(t)};new bo(Math.random());const So=Se.createContext(null),Xn=n=>(n.getAttributes()&2)===2,To=Se.memo(Se.forwardRef(({children:n,camera:t,scene:u,resolutionScale:f,enabled:r=!0,renderPriority:e=1,autoClear:i=!0,depthBuffer:s,enableNormalPass:a,stencilBuffer:o,multisampling:l=8,frameBufferType:c=Yi},h)=>{const{gl:d,scene:v,camera:g,size:m}=Wt(),F=u||v,x=t||g,[S,b,U]=Se.useMemo(()=>{const w=new os(d,{depthBuffer:s,stencilBuffer:o,multisampling:l,frameBufferType:c});w.addPass(new mi(F,x));let O=null,C=null;return a&&(C=new go(F,x),C.enabled=!1,w.addPass(C),f!==void 0&&(O=new uo({normalBuffer:C.texture,resolutionScale:f}),O.enabled=!1,w.addPass(O))),[w,C,O]},[x,d,s,o,l,c,F,a,f]);Se.useEffect(()=>S?.setSize(m.width,m.height),[S,m]),jt((w,O)=>{if(r){const C=d.autoClear;d.autoClear=i,o&&!i&&d.clearStencil(),S.render(O),d.autoClear=C}},r?e:0);const P=Se.useRef(null);Se.useLayoutEffect(()=>{const w=[],O=P.current.__r3f;if(O&&S){const C=O.children;for(let X=0;X<C.length;X++){const y=C[X].object;if(y instanceof Vr){const R=[y];if(!Xn(y)){let W=null;for(;(W=C[X+1]?.object)instanceof Vr&&!Xn(W);)R.push(W),X++}const M=new po(x,...R);w.push(M)}else y instanceof Xe&&w.push(y)}for(const X of w)S?.addPass(X);b&&(b.enabled=!0),U&&(U.enabled=!0)}return()=>{for(const C of w)S?.removePass(C);b&&(b.enabled=!1),U&&(U.enabled=!1)}},[S,n,x,b,U]),Se.useEffect(()=>{const w=d.toneMapping;return d.toneMapping=Ki,()=>{d.toneMapping=w}},[d]);const _=Se.useMemo(()=>({composer:S,normalPass:b,downSamplingPass:U,resolutionScale:f,camera:x,scene:F}),[S,b,U,f,x,F]);return Se.useImperativeHandle(h,()=>S,[S]),he.jsx(So.Provider,{value:_,children:he.jsx("group",{ref:P,children:n})})}));let wo=0;const Yn=new WeakMap,Uo=(n,t)=>function({blendFunction:u=t?.blendFunction,opacity:f=t?.opacity,...r}){let e=Yn.get(n);if(!e){const a=`@react-three/postprocessing/${n.name}-${wo++}`;Zi({[a]:n}),Yn.set(n,e=a)}const i=Wt(a=>a.camera),s=Tt.useMemo(()=>[...t?.args??[],...r.args??[{...t,...r}]],[JSON.stringify(r)]);return he.jsx(e,{camera:i,"blendMode-blendFunction":u,"blendMode-opacity-value":f,...r,args:s})},_o=Uo(ao,{blendFunction:0});function Eo(){return typeof window>"u"?!1:window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1}function Mo(){const n=typeof document<"u"?document.visibilityState!=="hidden":!0,t=Tt.useRef(n);return Tt.useEffect(()=>{const u=()=>t.current=document.visibilityState!=="hidden";return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[]),t}const Kn={idle:{core:"#5EEAD4",glow:"#60A5FA",accent:"#22D3EE",text:"#E0F2FE",pulse:2.2,distort:.12,bloom:.35},listening:{core:"#FCD34D",glow:"#F59E0B",accent:"#FBBF24",text:"#FFF7ED",pulse:2.6,distort:.14,bloom:.48},thinking:{core:"#67E8F9",glow:"#A78BFA",accent:"#22D3EE",text:"#BAE6FD",pulse:3.2,distort:.18,bloom:.45},speaking:{core:"#F472B6",glow:"#38BDF8",accent:"#06B6D4",text:"#FFE4FA",pulse:4,distort:.22,bloom:.55}};function Do({color:n="#60A5FA",intensity:t=.45,power:u=2.2,bias:f=.06}){const r=Tt.useMemo(()=>new rt({uniforms:{uColor:{value:new pt(n)},uBias:{value:f},uPower:{value:u},uIntensity:{value:t}},vertexShader:`
          varying vec3 vNormal;
          varying vec3 vWorldPos;
          void main() {
            vNormal = normalize(normalMatrix * normal);
            vec4 worldPos = modelMatrix * vec4(position, 1.0);
            vWorldPos = worldPos.xyz;
            gl_Position = projectionMatrix * viewMatrix * worldPos;
          }
        `,fragmentShader:`
          uniform vec3 uColor;
          uniform float uBias;
          uniform float uPower;
          uniform float uIntensity;
          varying vec3 vNormal;
          varying vec3 vWorldPos;
          void main() {
            vec3 viewDir = normalize(cameraPosition - vWorldPos);
            float f = pow(uBias + (1.0 - max(dot(viewDir, vNormal), 0.0)), uPower);
            vec3 col = uColor * f * uIntensity;
            gl_FragColor = vec4(col, f);
          }
        `,transparent:!0,blending:ti,depthWrite:!1,depthTest:!1}),[n,t,u,f]);return he.jsx("primitive",{object:r,attach:"material"})}function Ao({text:n="NOVA",radius:t=1.7,speed:u=.55,color:f="#E0F2FE"}){const r=Tt.useMemo(()=>[...n].map(()=>Tt.createRef()),[n]);return jt(({clock:e,camera:i})=>{const a=e.getElapsedTime()*u,o=.32,l=(n.length-1)*o/2;[...n].forEach((c,h)=>{const d=a+h*o-l,v=t*Math.cos(d),g=-t*Math.sin(d),m=r[h].current;m&&(m.position.set(v,.13,g),m.quaternion.copy(i.quaternion))})}),he.jsx(he.Fragment,{children:[...n].map((e,i)=>he.jsx(Ja,{ref:r[i],fontSize:.41,color:f,anchorX:"center",anchorY:"middle",outlineWidth:.035,outlineColor:"#FFFFFF",outlineOpacity:.85,renderOrder:10,children:e},i))})}function Co({url:n,radius:t=1.1}){const u=qr(n);return u.wrapS=u.wrapT=Qi,u.repeat.set(3,3),he.jsxs("mesh",{renderOrder:2,children:[he.jsx("sphereGeometry",{args:[t,64,64]}),he.jsx("meshStandardMaterial",{map:u,transparent:!0,opacity:.35,polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:2,depthWrite:!1,depthTest:!0})]})}function Ro({radius:n=1.12,color:t="#38BDF8",opacity:u=.25,speed:f=.1,segments:r=40}){const e=Se.useRef(),i=Se.useMemo(()=>new qi(n,r,r),[n,r]),s=Se.useMemo(()=>new $i(i,30),[i]),a=Se.useMemo(()=>new ea({color:t,transparent:!0,opacity:u,depthWrite:!1}),[t,u]);return jt((o,l)=>{e.current&&(e.current.rotation.y+=f*l)}),he.jsxs("lineSegments",{ref:e,renderOrder:2,children:[he.jsx("primitive",{attach:"geometry",object:s}),he.jsx("primitive",{attach:"material",object:a})]})}function Fo({color:n="#60A5FA"}){const t=Se.useMemo(()=>new Zn({color:n,transparent:!0,opacity:.22,blending:ti,depthWrite:!1}),[n]);return he.jsxs("group",{renderOrder:2,children:[he.jsxs("mesh",{rotation:[Math.PI/2.8,.3,0],position:[0,0,0],children:[he.jsx("torusGeometry",{args:[1.24,.005,8,180]}),he.jsx("primitive",{object:t,attach:"material"})]}),he.jsxs("mesh",{rotation:[Math.PI/2.4,-.6,.2],position:[0,0,0],children:[he.jsx("torusGeometry",{args:[1.18,.005,8,160]}),he.jsx("primitive",{object:t,attach:"material"})]})]})}function Bo({theme:n,quality:t="auto",hexTextureUrl:u="",motionEnabled:f=!0}){const r=Se.useRef(),e=Se.useRef(),i=Se.useRef(),s=Se.useMemo(()=>t==="high"?96:t==="low"?32:typeof navigator<"u"&&/Mobi|Android/i.test(navigator.userAgent)?40:64,[t]);return jt(({clock:a},o)=>{if(!f)return;const l=a.getElapsedTime(),c=1+.02*Math.sin(l*n.pulse);if(r.current&&r.current.scale.setScalar(c),e.current){const h=1+.06*Math.sin(l*(n.pulse*1.15));e.current.scale.setScalar(h),e.current.rotation.y+=.6*o,e.current.rotation.x-=.35*o}i.current&&(i.current.rotation.y-=.05*o)}),Se.useEffect(()=>{r.current&&(r.current.renderOrder=1),i.current&&(i.current.renderOrder=3)},[]),he.jsxs(he.Fragment,{children:[he.jsxs("mesh",{ref:r,children:[he.jsx("sphereGeometry",{args:[1,s,s]}),he.jsx($a,{color:n.core,distort:n.distort,speed:f?n.pulse:0,transparent:!0,opacity:.22,roughness:.1,metalness:.65,emissive:n.core,emissiveIntensity:.18,depthWrite:!0,depthTest:!0})]}),he.jsxs("mesh",{ref:e,renderOrder:1,scale:.3,children:[he.jsx("icosahedronGeometry",{args:[.42,0]}),he.jsx("meshStandardMaterial",{color:n.accent,emissive:n.accent,emissiveIntensity:.9,metalness:.2,roughness:.35,transparent:!0,opacity:.8,depthWrite:!1})]}),u?he.jsx(Co,{url:u,radius:1.1}):null,he.jsx(Ro,{radius:1.12,color:n.glow,opacity:.22,speed:.08,segments:48}),he.jsxs("mesh",{ref:i,children:[he.jsx("sphereGeometry",{args:[1.18,s,s]}),he.jsx(Do,{color:n.glow,intensity:.42,power:2.1,bias:.06})]}),he.jsx(Fo,{color:n.glow})]})}function ko({maxDpr:n=2}){const{gl:t}=Wt();return Se.useEffect(()=>{const u=Math.min(n,typeof window<"u"&&window.devicePixelRatio||1);t.setPixelRatio(u),t.shadowMap.enabled=!1,t.sortObjects=!0},[t,n]),null}function Go({state:n="idle",size:t=400,showText:u=!0,text:f="NOVA",hexTextureUrl:r="",quality:e="auto",bloom:i=!0}){const s=Eo(),a=Mo(),o=Kn[n]??Kn.idle,l=!s&&a.current,c=Se.useMemo(()=>({width:t,height:t,position:"relative",zIndex:10}),[t]);return he.jsx("div",{style:c,children:he.jsxs(Ji,{camera:{position:[0,0,7.5],fov:50},style:{background:"transparent"},gl:{antialias:!0,alpha:!0,powerPreference:"high-performance",stencil:!1,depth:!0},onCreated:({gl:h})=>h.setClearColor(0,0),frameloop:"always",children:[he.jsx(ko,{maxDpr:l?2:1.25}),he.jsx("ambientLight",{intensity:1}),he.jsx("directionalLight",{position:[4,6,8],intensity:.9,color:o.core}),he.jsx("directionalLight",{position:[-4,-3,-6],intensity:.4,color:o.glow}),!s&&i&&he.jsx(To,{multisampling:0,children:he.jsx(_o,{intensity:o.bloom,radius:.42,luminanceThreshold:.45,luminanceSmoothing:.16})}),he.jsx(Bo,{theme:o,quality:e,hexTextureUrl:r,motionEnabled:l}),u&&he.jsx(Ao,{text:f,color:o.text})]})})}export{Go as default};
