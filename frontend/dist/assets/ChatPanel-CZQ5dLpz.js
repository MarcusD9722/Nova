import{r as l,j as t}from"./index-D0eijIkW.js";const J={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},m=(()=>{try{const n=J?.VITE_API_BASE?String(void 0):"";if(n)return n.replace(/\/$/,"")}catch{}try{const n=window,o=n&&n.__NOVA_API_BASE?String(n.__NOVA_API_BASE):"";if(o)return o.replace(/\/$/,"")}catch{}return"http://localhost:8080"})();async function q(n){const o=new FormData;for(const s of n)o.append("files",s);const i=await fetch(`${m}/file-upload`,{method:"POST",body:o});if(!i.ok)throw new Error(await i.text());return(await i.json()).files||[]}function Z({messages:n=[],onSendMessage:o,onFileUpload:i,onStop:c,isAssistantThinking:s=!1}){const h=l.useRef(null),g=l.useRef(null),_=l.useRef(null),v=l.useRef(null),D=l.useRef(null),[x,j]=l.useState(""),[b,f]=l.useState([]),[P,N]=l.useState(!1),[k,C]=l.useState(!0),T=o||((e,a)=>{alert("Sent! (demo fallback): "+e+(a?.length?` [${a.length} file(s)]`:""))}),y=i||(async e=>{const a=await q(e);return f(r=>[...r,...a]),a});l.useEffect(()=>{h.current?.focus()},[]);const w=l.useCallback((e="smooth")=>{_.current?.scrollIntoView({behavior:e,block:"end"})},[]);l.useEffect(()=>{k&&w(n.length<5?"auto":"smooth")},[n,k,w]);const B=l.useCallback(()=>{const e=g.current;if(!e)return;const r=e.scrollHeight-e.scrollTop-e.clientHeight<48;C(r)},[]),E=l.useCallback(()=>{const e=D.current;if(!e)return;e.style.height="0px";const a=Math.min(220,e.scrollHeight);e.style.height=a+"px"},[]);l.useEffect(()=>E(),[x,E]);const I=e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault(),(x.trim()||b.length)&&A();return}if(e.key==="ArrowUp"&&!x.trim()){const a=[...n].reverse().find(r=>r.sender==="user");a?.text&&j(a.text)}},A=()=>{const e=x.trim();!e&&b.length===0||(T(e,b),j(""),f([]),v.current&&(v.current.value=""),setTimeout(()=>w("auto"),0))},O=async e=>{if(e.target.files&&e.target.files.length){const a=Array.from(e.target.files);try{const r=await y(a);f(u=>[...u,...r])}finally{e.target.value=""}}},S=l.useCallback(async e=>{if(e.clipboardData?.files?.length){e.preventDefault();const a=Array.from(e.clipboardData.files),r=await y(a);f(u=>[...u,...r])}},[y]);l.useEffect(()=>{const e=h.current;if(e)return e.addEventListener("paste",S),()=>e.removeEventListener("paste",S)},[S]);const F=e=>{e.preventDefault(),e.stopPropagation(),N(!0)},L=e=>{e.preventDefault(),e.stopPropagation()},M=e=>{e.preventDefault(),e.stopPropagation(),N(!1)},z=async e=>{e.preventDefault(),e.stopPropagation(),N(!1);const a=Array.from(e.dataTransfer.files||[]);if(a.length){const r=await y(a);f(u=>[...u,...r])}},V=l.useCallback((e,a)=>{const r=[],u=/```([\w+-]*)\n([\s\S]*?)```/g;let d=0,p;for(;(p=u.exec(e))!==null;){const[U,K,W]=p;p.index>d&&r.push($(e.slice(d,p.index))),r.push(t.jsx(X,{code:W,lang:K||""},`code-${p.index}`)),d=p.index+U.length}return d<e.length&&r.push($(e.slice(d))),a&&r.push(t.jsx("span",{className:"inline-block w-2 h-4 align-bottom animate-pulse bg-cyan-300/80 ml-1 rounded-[2px]"},"caret")),t.jsx(t.Fragment,{children:r})},[]),H=s||!!n.length&&n[n.length-1]?.streaming;return t.jsxs("form",{className:`relative flex flex-col w-full h-full min-w-0 min-h-0
      bg-gradient-to-br from-[#13142a]/80 via-[#262b41]/70 to-[#181928]/90
      backdrop-blur-2xl border border-cyan-500/30 rounded-3xl
      shadow-[0_8px_32px_0_rgba(12,16,56,0.36)]
      before:absolute before:inset-0 before:rounded-3xl before:opacity-60 before:pointer-events-none
      before:bg-gradient-to-br before:from-cyan-400/20 before:to-fuchsia-500/10
      after:absolute after:inset-0 after:rounded-3xl after:pointer-events-none after:ring-2 after:ring-cyan-400/20`,style:{boxSizing:"border-box"},onSubmit:e=>{e.preventDefault(),A()},autoComplete:"off",onDragEnter:F,onDragOver:L,onDragLeave:M,onDrop:z,"aria-label":"Chat panel",children:[P&&t.jsx("div",{className:"absolute inset-0 z-20 rounded-3xl bg-cyan-400/10 ring-2 ring-cyan-300/40 grid place-items-center pointer-events-none",children:t.jsx("div",{className:"text-cyan-100 font-medium",children:"Drop files to attach"})}),t.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-4/5 h-1.5 bg-gradient-to-r from-cyan-400/40 via-fuchsia-400/20 to-cyan-400/40 blur-lg opacity-80 rounded-b-3xl pointer-events-none"}),t.jsxs("div",{ref:g,className:"flex-1 overflow-y-auto mb-2 min-h-0 pt-1 px-1",onScroll:B,children:[n.map((e,a)=>{const r=e.sender==="system",u=e.sender==="user";return r?t.jsx("div",{className:"my-2 text-center",children:t.jsx("span",{className:"inline-block text-[11px] px-2 py-1 rounded-full bg-white/5 border border-white/10 text-white/60",children:e.text})},e.id??a):t.jsx("div",{className:`mb-1 ${u?"text-right":"text-left"}`,children:t.jsxs(G,{isUser:u,streaming:!!e.streaming,children:[t.jsx("div",{className:"whitespace-pre-wrap break-words leading-relaxed",children:V(e.text||"",e.streaming)}),!!e.files?.length&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:e.files.map((d,p)=>t.jsxs("span",{className:"text-xs px-2 py-1 rounded-lg border border-white/10 bg-black/20 hover:bg-black/30",title:d.name,children:["ðŸ“Ž ",R(d.name,28),d.url?t.jsx("a",{href:m?`${m}${d.url}`:d.url,target:"_blank",rel:"noreferrer",className:"underline ml-1",children:"open"}):null]},p))}),e.error&&t.jsxs("div",{className:"mt-1 text-[11px] text-red-300/80",children:["âš  ",e.error]})]})},e.id??a)}),s&&t.jsx("div",{className:"mb-1 text-left",children:t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-2xl px-3 py-1.5 bg-white/10 border border-cyan-200/10 text-cyan-200",children:[t.jsx(Q,{}),t.jsx("span",{className:"text-xs opacity-80",children:"thinkingâ€¦"})]})}),t.jsx("div",{ref:_})]}),!k&&t.jsx("button",{type:"button",onClick:()=>{C(!0),w("smooth")},className:"absolute bottom-24 right-4 z-10 text-xs px-2 py-1 rounded-md bg-black/40 border border-white/10 text-white/80 hover:text-white hover:bg-black/60","aria-label":"Jump to latest messages",children:"Jump to latest â†“"}),!!b.length&&t.jsx("div",{className:"mx-1 mb-1 flex flex-wrap gap-2",children:b.map((e,a)=>t.jsxs("span",{className:"text-xs px-2 py-1 rounded-lg border border-white/10 bg-black/30 text-white/80 flex items-center gap-1",children:["ðŸ“Ž ",R(e.name,28),e.url?t.jsx("a",{href:m?`${m}${e.url}`:e.url,target:"_blank",rel:"noreferrer",className:"underline ml-1",children:"open"}):null,t.jsx("button",{type:"button",className:"ml-1 text-white/50 hover:text-white",onClick:()=>f(r=>r.filter((u,d)=>d!==a)),"aria-label":`Remove ${e.name}`,title:"Remove",children:"âœ•"})]},a))}),t.jsxs("div",{className:"flex gap-2 mt-auto p-1",children:[t.jsx("textarea",{ref:e=>{h.current=e,D.current=e},className:`flex-1 rounded-xl px-4 py-2 bg-black/30 border border-cyan-600/30 outline-none text-cyan-100
          placeholder:text-cyan-200/60 font-mono shadow focus:ring-2 focus:ring-cyan-500/40 transition
          max-h-[220px] resize-none`,placeholder:"Type a messageâ€¦",value:x,onChange:e=>j(e.target.value),onKeyDown:I,"aria-label":"Message input"}),t.jsxs("label",{className:`cursor-pointer bg-gradient-to-br from-cyan-500 to-fuchsia-500 text-white rounded-xl px-3 py-2 shadow-lg
          hover:scale-105 transition-all duration-100 flex items-center`,title:"Upload files",children:[t.jsx("input",{ref:v,type:"file",className:"hidden",onChange:O,multiple:!0}),t.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24","aria-hidden":"true",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),t.jsx("span",{className:"hidden sm:inline",children:"File"})]}),H&&t.jsx("button",{type:"button",onClick:()=>c?.(),className:"rounded-xl px-3 py-2 bg-black/40 border border-white/10 text-white/80 hover:text-white",title:"Stop generating",children:"Stop"}),t.jsx("button",{type:"submit",className:`rounded-xl px-4 py-2 bg-gradient-to-br from-cyan-500 to-fuchsia-500 text-white shadow-lg
          hover:scale-105 hover:bg-cyan-600/90 transition-all duration-100`,title:"Send (Enter)",children:"Send"})]})]})}function G({isUser:n,streaming:o,children:i}){const c=n?"items-end":"items-start",s=n?"bubble-tail-right":"bubble-tail-left",h=n?"bubble-user glow-breathe-user":"bubble-assistant glow-breathe-assistant",g=o?"glow-stream":"";return t.jsx("div",{className:`inline-block max-w-[85%] ${c}`,children:t.jsx("div",{className:["bubble-base nova-glass nova-border nova-scan nova-sheen nova-float",h,s,g].join(" "),children:i})})}function R(n,o){return n.length>o?n.slice(0,o-1)+"â€¦":n}function Q(){return t.jsxs("span",{"aria-hidden":!0,className:"inline-flex gap-1 px-1",children:[t.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-300/80 rounded-full animate-bounce [animation-delay:-0.2s]"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-300/80 rounded-full animate-bounce"}),t.jsx("span",{className:"w-1.5 h-1.5 bg-cyan-300/80 rounded-full animate-bounce [animation-delay:0.2s]"})]})}function X({code:n,lang:o}){const[i,c]=l.useState(!1),s=async()=>{try{await navigator.clipboard.writeText(n),c(!0),setTimeout(()=>c(!1),900)}catch{}};return t.jsxs("div",{className:"group relative my-2",children:[t.jsxs("pre",{className:"rounded-xl border border-white/10 bg-black/40 px-3 py-2 overflow-auto text-[12.5px] leading-6",children:[t.jsx("div",{className:"text-[11px] opacity-60 mb-1",children:o||"code"}),t.jsx("code",{className:"whitespace-pre",children:n})]}),t.jsx("button",{type:"button",onClick:s,className:"absolute top-2 right-2 text-xs px-2 py-1 rounded-md bg-black/40 border border-white/10 text-white/70 hover:text-white opacity-0 group-hover:opacity-100 transition",title:"Copy",children:i?"Copied":"Copy"})]})}function $(n){const o=/((https?:\/\/|www\.)[^\s<]+)/g,i=[];let c=0,s;for(;(s=o.exec(n))!==null;){s.index>c&&i.push(n.slice(c,s.index));let h=s[0];h.startsWith("www.")&&(h="https://"+h),i.push(t.jsx("a",{href:h,target:"_blank",rel:"noreferrer",className:"underline decoration-cyan-400/60 hover:decoration-cyan-300",children:s[0]},`u-${s.index}`)),c=s.index+s[0].length}return c<n.length&&i.push(n.slice(c)),t.jsx(t.Fragment,{children:i})}export{Z as default};
